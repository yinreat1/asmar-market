<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
<title>AS-MAR Market</title>
<meta name="description" content="GÃ¼mrÃ¼k LojmanlarÄ± kapÄ±ya teslimat marketi">
<meta name="theme-color" content="#e07b1a">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="AS-MAR">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #e07b1a;
  --primary-dark: #c5680f;
  --primary-light: #f5a44a;
  --bg: #f4f4f6;
  --text: #1a1a2e;
  --text-muted: #6b7280;
  --border: #e5e7eb;
  --success: #10b981;
  --danger: #ef4444;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 40px rgba(0,0,0,0.14);
  --radius: 16px;
  --radius-sm: 10px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }

/* SCREENS */
.screen { display: none; min-height: 100vh; flex-direction: column; }
.screen.active { display: flex; }

/* LOADING */
#loadingOverlay { position: fixed; inset: 0; background: rgba(255,255,255,0.92); z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 14px; }
.spinner { width: 46px; height: 46px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text { font-size: 14px; font-weight: 700; color: var(--text-muted); }

/* TOAST */
.toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(20px); background: #1a1a2e; color: white; padding: 12px 24px; border-radius: 14px; font-size: 14px; font-weight: 700; z-index: 9998; opacity: 0; transition: all 0.3s; pointer-events: none; white-space: nowrap; max-width: 90vw; text-align: center; }
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.error { background: var(--danger); }
.toast.success { background: var(--success); }

/* FORMS */
.form-group { margin-bottom: 16px; }
.form-group label { font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 6px; }
.form-group input, .form-group select, .form-group textarea {
  width: 100%; padding: 13px 16px; border: 2px solid var(--border); border-radius: var(--radius-sm);
  font-family: inherit; font-size: 15px; color: var(--text); background: #fafafa; transition: 0.2s; outline: none;
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  border-color: var(--primary); background: white; box-shadow: 0 0 0 3px rgba(224,123,26,0.12);
}
.addr-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* BUTTONS */
.btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 14px; border-radius: var(--radius-sm); border: none; font-family: inherit; font-size: 16px; font-weight: 800; cursor: pointer; transition: 0.2s; }
.btn-primary { background: var(--primary); color: white; }
.btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(224,123,26,0.35); }
.btn-outline { background: transparent; color: var(--primary); border: 2px solid var(--primary); }
.btn-outline:hover { background: var(--primary); color: white; }
.btn-sm { padding: 8px 13px; font-size: 13px; width: auto; border-radius: 8px; }
.btn-danger { background: var(--danger); color: white; }
.btn-success { background: var(--success); color: white; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#loginScreen { background: linear-gradient(135deg, #fff8f0 0%, #ffecd2 100%); align-items: center; justify-content: center; padding: 24px; min-height: 100vh; }
.login-card { background: white; border-radius: 28px; padding: 36px 28px; width: 100%; max-width: 420px; box-shadow: var(--shadow-lg); }
.login-logo { text-align: center; margin-bottom: 20px; }
.login-logo img { width: 110px; border-radius: 14px; }
.login-logo-fallback { font-size: 28px; font-weight: 900; color: var(--primary); display: none; }
.login-title { font-size: 24px; font-weight: 900; text-align: center; margin-bottom: 4px; }
.login-sub { text-align: center; color: var(--text-muted); font-size: 13px; margin-bottom: 20px; line-height: 1.5; }
.login-info { background: #fff8f0; border: 1.5px solid #f5a44a; border-radius: 10px; padding: 11px 14px; font-size: 13px; color: #8a5100; margin-bottom: 18px; }
.login-switch { text-align: center; margin-top: 18px; font-size: 14px; color: var(--text-muted); }
.login-switch a { color: var(--primary); font-weight: 700; cursor: pointer; }
.login-switch a:hover { text-decoration: underline; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOPBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar { background: white; padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.06); position: sticky; top: 0; z-index: 100; }
.topbar-logo img { height: 40px; border-radius: 8px; }
.topbar-right { display: flex; align-items: center; gap: 10px; }
.user-info { font-size: 11px; color: var(--text-muted); text-align: right; line-height: 1.3; }
.user-info strong { display: block; color: var(--text); font-size: 13px; }
.cart-btn { position: relative; background: var(--primary); color: white; border: none; border-radius: 12px; padding: 9px 13px; font-size: 20px; cursor: pointer; transition: 0.2s; }
.cart-btn:hover { background: var(--primary-dark); }
.cart-badge { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; font-weight: 800; display: flex; align-items: center; justify-content: center; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav { background: white; border-top: 1.5px solid var(--border); display: flex; position: sticky; bottom: 0; z-index: 100; }
.nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 9px 4px; cursor: pointer; border: none; background: none; font-family: inherit; font-size: 11px; color: var(--text-muted); gap: 3px; transition: 0.2s; }
.nav-item.active { color: var(--primary); }
.nav-icon { font-size: 22px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page { display: none; flex: 1; overflow-y: auto; }
.page.active { display: block; }
.page-header { background: white; padding: 13px 18px; display: flex; align-items: center; gap: 12px; box-shadow: var(--shadow); }
.back-btn { background: none; border: none; font-size: 22px; cursor: pointer; color: var(--text); }
.page-title { font-size: 17px; font-weight: 900; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.delivery-strip { background: linear-gradient(90deg, var(--primary), var(--primary-light)); color: white; padding: 9px 18px; font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
.search-wrap { padding: 14px 18px 8px; }
.search-box { display: flex; align-items: center; gap: 10px; background: white; border-radius: 14px; padding: 11px 16px; box-shadow: var(--shadow); }
.search-box input { border: none; outline: none; font-family: inherit; font-size: 15px; flex: 1; color: var(--text); background: transparent; }
.search-box input::placeholder { color: #b0b6c1; }

.section { padding: 12px 18px; }
.sec-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
.sec-title { font-size: 17px; font-weight: 900; }
.see-all { color: var(--primary); font-size: 13px; font-weight: 700; cursor: pointer; background: none; border: none; font-family: inherit; }

.cats-row { display: flex; gap: 11px; overflow-x: auto; padding-bottom: 6px; scrollbar-width: none; }
.cats-row::-webkit-scrollbar { display: none; }
.cat-chip { display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; min-width: 66px; }
.cat-chip-icon { width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 26px; transition: 0.2s; }
.cat-chip-icon:hover { transform: scale(1.08); }
.cat-chip-label { font-size: 11px; font-weight: 700; text-align: center; white-space: nowrap; }

.hero { margin: 4px 18px 12px; background: linear-gradient(135deg, var(--primary), #f5a44a); border-radius: 20px; padding: 22px; color: white; position: relative; overflow: hidden; }
.hero::after { content: 'ğŸ '; position: absolute; right: 18px; top: 50%; transform: translateY(-50%); font-size: 72px; opacity: 0.15; }
.hero-badge { background: rgba(255,255,255,0.22); display: inline-block; padding: 3px 11px; border-radius: 20px; font-size: 11px; font-weight: 700; margin-bottom: 7px; }
.hero-title { font-size: 22px; font-weight: 900; margin-bottom: 5px; }
.hero-sub { font-size: 13px; opacity: 0.9; margin-bottom: 13px; line-height: 1.4; }
.hero-cta { background: white; color: var(--primary); padding: 8px 18px; border-radius: 9px; font-weight: 800; font-size: 14px; border: none; cursor: pointer; font-family: inherit; }

.products-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 13px; }
.product-card { background: white; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); transition: 0.2s; }
.product-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
.product-img { width: 100%; height: 135px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 46px; overflow: hidden; }
.product-img img { width: 100%; height: 100%; object-fit: cover; }
.product-body { padding: 11px; }
.product-name { font-size: 13px; font-weight: 800; margin-bottom: 2px; line-height: 1.3; }
.product-cat-label { font-size: 11px; color: var(--text-muted); margin-bottom: 7px; }
.product-prices { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; margin-bottom: 9px; }
.price-now { font-size: 15px; font-weight: 900; color: var(--primary); }
.price-was { font-size: 12px; color: var(--text-muted); text-decoration: line-through; }
.sale-tag { background: var(--danger); color: white; font-size: 10px; font-weight: 800; padding: 2px 6px; border-radius: 5px; }
.add-to-cart { width: 100%; padding: 8px; background: var(--bg); border: 1.5px solid var(--border); border-radius: 9px; font-family: inherit; font-size: 13px; font-weight: 700; cursor: pointer; transition: 0.2s; color: var(--primary); }
.add-to-cart:hover { background: var(--primary); color: white; border-color: var(--primary); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CATEGORIES PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cat-full-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 13px; padding: 16px 18px; }
.cat-full-card { background: white; border-radius: var(--radius); padding: 22px 14px; text-align: center; box-shadow: var(--shadow); cursor: pointer; transition: 0.2s; border: 2px solid transparent; }
.cat-full-card:hover { border-color: var(--primary); transform: translateY(-2px); }
.cat-full-icon { font-size: 42px; margin-bottom: 9px; }
.cat-full-name { font-size: 14px; font-weight: 800; }
.cat-full-count { font-size: 12px; color: var(--text-muted); margin-top: 3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CART â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cart-list { padding: 14px 18px; }
.cart-item { background: white; border-radius: var(--radius); padding: 13px; display: flex; gap: 12px; align-items: center; margin-bottom: 11px; box-shadow: var(--shadow); }
.cart-img { width: 64px; height: 64px; border-radius: 12px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0; overflow: hidden; }
.cart-img img { width: 100%; height: 100%; object-fit: cover; }
.cart-info { flex: 1; }
.cart-name { font-size: 14px; font-weight: 800; margin-bottom: 3px; }
.cart-price { color: var(--primary); font-weight: 900; font-size: 15px; }
.qty-row { display: flex; align-items: center; gap: 9px; margin-top: 7px; }
.qty-btn { width: 30px; height: 30px; border-radius: 8px; border: 2px solid var(--border); background: none; font-size: 17px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; font-family: inherit; }
.qty-btn:hover { border-color: var(--primary); color: var(--primary); }
.qty-val { font-weight: 800; font-size: 16px; min-width: 22px; text-align: center; }
.del-btn { background: none; border: none; color: var(--danger); font-size: 20px; cursor: pointer; margin-left: auto; flex-shrink: 0; }
.cart-total-box { background: white; margin: 0 18px 18px; border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); }
.total-row { display: flex; justify-content: space-between; padding: 7px 0; font-size: 14px; border-bottom: 1px solid var(--border); }
.total-row:last-of-type { border-bottom: none; font-size: 17px; font-weight: 900; color: var(--primary); }
.total-row.free { color: var(--success); font-weight: 700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHECKOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.checkout-wrap { padding: 14px 18px; }
.checkout-card { background: white; border-radius: var(--radius); padding: 18px; box-shadow: var(--shadow); margin-bottom: 14px; }
.checkout-card-title { font-size: 16px; font-weight: 900; margin-bottom: 13px; }
.pay-opt { border: 2px solid var(--border); border-radius: 12px; padding: 13px 15px; display: flex; align-items: center; gap: 11px; cursor: pointer; margin-bottom: 10px; transition: 0.2s; }
.pay-opt.selected { border-color: var(--primary); background: #fff8f0; }
.pay-opt:last-child { margin-bottom: 0; }
.radio-dot { width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.pay-opt.selected .radio-dot { border-color: var(--primary); background: var(--primary); }
.pay-opt.selected .radio-dot::after { content: ''; width: 8px; height: 8px; border-radius: 50%; background: white; }
.pay-icon { font-size: 22px; }
.pay-label { font-weight: 700; font-size: 14px; }
.pay-sub { font-size: 12px; color: var(--text-muted); }
.iban-info { background: #f0f9ff; border: 1.5px solid #90cdf4; border-radius: 10px; padding: 13px; margin-top: 10px; font-size: 13px; line-height: 1.7; display: none; }
.iban-info strong { display: block; font-size: 14px; font-weight: 900; margin-bottom: 3px; }
.sticky-pay { background: white; padding: 13px 18px; border-top: 1.5px solid var(--border); }
.sticky-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PROFILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.profile-wrap { padding: 18px; }
.profile-hero { background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: var(--radius); padding: 26px 18px; color: white; text-align: center; margin-bottom: 18px; }
.p-avatar { width: 66px; height: 66px; background: rgba(255,255,255,0.28); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; margin: 0 auto 11px; }
.p-name { font-size: 20px; font-weight: 900; }
.p-email { font-size: 13px; opacity: 0.85; margin-top: 3px; }
.menu-row { background: white; border-radius: var(--radius-sm); padding: 15px; display: flex; align-items: center; gap: 13px; margin-bottom: 10px; box-shadow: var(--shadow); cursor: pointer; transition: 0.2s; }
.menu-row:hover { transform: translateX(4px); }
.menu-row-icon { font-size: 22px; }
.menu-row-text { flex: 1; font-weight: 700; font-size: 14px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: flex-end; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
.modal-bg.open { opacity: 1; pointer-events: all; }
.modal-box { background: white; border-radius: 24px 24px 0 0; padding: 26px 22px; width: 100%; max-width: 480px; max-height: 90vh; overflow-y: auto; transform: translateY(100%); transition: 0.3s; }
.modal-bg.open .modal-box { transform: translateY(0); }
.modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
.modal-head-title { font-size: 20px; font-weight: 900; }
.modal-close { background: var(--bg); border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 17px; cursor: pointer; }
.confirm-row { display: flex; justify-content: space-between; font-size: 14px; padding: 8px 0; border-bottom: 1px solid var(--border); }
.confirm-row:last-child { border: none; font-weight: 900; font-size: 17px; color: var(--primary); }

/* EMPTY */
.empty { text-align: center; padding: 60px 20px; color: var(--text-muted); }
.empty-icon { font-size: 58px; margin-bottom: 13px; }
.empty-title { font-size: 18px; font-weight: 800; color: var(--text); margin-bottom: 5px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADMIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#adminScreen { background: var(--bg); }
.adm-topbar { background: white; padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; }
.adm-logo { display: flex; align-items: center; gap: 9px; }
.adm-logo img { height: 34px; border-radius: 8px; }
.adm-logo-txt { font-size: 15px; font-weight: 900; }
.adm-logo-sub { font-size: 10px; color: var(--primary); font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
.adm-nav { display: flex; gap: 6px; overflow-x: auto; padding: 11px 16px; scrollbar-width: none; background: white; border-bottom: 1.5px solid var(--border); }
.adm-nav::-webkit-scrollbar { display: none; }
.adm-nav-btn { padding: 8px 13px; border-radius: 9px; border: none; font-family: inherit; font-size: 13px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: 0.2s; background: var(--bg); color: var(--text-muted); }
.adm-nav-btn.active { background: var(--primary); color: white; }
.adm-page { display: none; padding: 18px; overflow-y: auto; min-height: calc(100vh - 120px); }
.adm-page.active { display: block; }

.stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 11px; margin-bottom: 18px; }
.stat-box { background: white; border-radius: var(--radius); padding: 15px; box-shadow: var(--shadow); text-align: center; }
.stat-box-icon { font-size: 24px; margin-bottom: 5px; }
.stat-box-label { font-size: 11px; color: var(--text-muted); }
.stat-box-val { font-size: 22px; font-weight: 900; }

.adm-card { background: white; border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); margin-bottom: 14px; }
.adm-card-title { font-size: 15px; font-weight: 900; margin-bottom: 13px; display: flex; align-items: center; justify-content: space-between; }

.prod-row { display: flex; align-items: center; gap: 11px; padding: 11px 0; border-bottom: 1px solid var(--border); }
.prod-row:last-child { border-bottom: none; }
.prod-row-img { width: 54px; height: 54px; border-radius: 11px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 22px; overflow: hidden; flex-shrink: 0; }
.prod-row-img img { width: 100%; height: 100%; object-fit: cover; }
.prod-row-info { flex: 1; min-width: 0; }
.prod-row-name { font-weight: 800; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.prod-row-cat { font-size: 11px; color: var(--text-muted); }
.prod-row-prices { display: flex; align-items: center; gap: 6px; }
.prod-price { font-weight: 900; color: var(--primary); font-size: 14px; }
.prod-old { font-size: 11px; color: var(--text-muted); text-decoration: line-through; }
.prod-row-acts { display: flex; gap: 6px; flex-shrink: 0; }

.img-prev { width: 100%; height: 148px; background: #f0f0f0; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 46px; margin-bottom: 12px; overflow: hidden; border: 2px dashed var(--border); }
.img-prev img { width: 100%; height: 100%; object-fit: cover; }
.img-tabs { display: flex; gap: 8px; margin-bottom: 13px; }
.img-tab { flex: 1; padding: 8px; border-radius: 8px; border: 1.5px solid var(--border); font-family: inherit; font-size: 13px; font-weight: 700; cursor: pointer; background: none; transition: 0.2s; }
.img-tab.active { border-color: var(--primary); color: var(--primary); background: #fff8f0; }

.order-card { background: white; border-radius: var(--radius); padding: 15px; box-shadow: var(--shadow); margin-bottom: 12px; }
.order-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.order-id { font-weight: 900; font-size: 14px; }
.status-badge { padding: 4px 11px; border-radius: 20px; font-size: 12px; font-weight: 700; }
.s-new { background: #fff3e0; color: #e07b1a; }
.s-done { background: #e8f5e9; color: #2e7d32; }
.s-cancelled { background: #ffebee; color: #c62828; }
.order-detail { font-size: 13px; color: var(--text-muted); margin-bottom: 3px; }
.order-items-text { font-size: 13px; margin: 7px 0; }
.order-total-text { font-weight: 900; font-size: 16px; color: var(--primary); margin-top: 6px; }
.order-actions { display: flex; gap: 8px; margin-top: 11px; }

/* Settings */
.settings-section { margin-bottom: 20px; }
.settings-section-title { font-size: 14px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 10px; }
.block-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
.block-item:last-child { border-bottom: none; }
.block-name { font-weight: 800; font-size: 15px; }
.block-add-row { display: flex; gap: 8px; margin-top: 10px; }
.block-add-row input { flex: 1; padding: 10px 14px; border: 2px solid var(--border); border-radius: 9px; font-family: inherit; font-size: 14px; outline: none; }
.block-add-row input:focus { border-color: var(--primary); }
.checkbox-row { display: flex; align-items: center; gap: 9px; font-size: 14px; font-weight: 700; cursor: pointer; margin-bottom: 14px; }
.checkbox-row input { width: 18px; height: 18px; accent-color: var(--primary); }

/* SipariÅŸ Ã¼rÃ¼n listesi */
.order-items-list { margin: 8px 0; }
.order-item-row { display: flex; align-items: center; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
.order-item-row:last-child { border-bottom: none; }
.order-item-name { flex: 1; font-weight: 700; }
.order-item-qty { color: var(--text-muted); margin: 0 10px; }
.order-item-price { font-weight: 800; color: var(--primary); }

/* PWA Banner */
.pwa-banner { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 2px solid var(--primary); padding: 14px 18px; z-index: 9990; display: flex; align-items: center; gap: 12px; box-shadow: 0 -4px 20px rgba(0,0,0,0.12); }
.pwa-icon { font-size: 36px; flex-shrink: 0; }
.pwa-text { flex: 1; }
.pwa-text strong { display: block; font-size: 14px; font-weight: 900; }
.pwa-text span { font-size: 12px; color: var(--text-muted); }
.pwa-btn { background: var(--primary); color: white; border: none; border-radius: 10px; padding: 9px 14px; font-family: inherit; font-weight: 800; font-size: 13px; cursor: pointer; white-space: nowrap; }
.pwa-close { background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-muted); flex-shrink: 0; }

/* Remember Me */
.remember-me-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 8px; }
.remember-label { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.toggle-wrap { position: relative; width: 46px; height: 26px; flex-shrink: 0; }
.toggle-wrap input { opacity: 0; width: 0; height: 0; position: absolute; }
.toggle-slider { position: absolute; inset: 0; background: #d1d5db; border-radius: 13px; transition: 0.3s; }
.toggle-slider::before { content: ''; position: absolute; width: 20px; height: 20px; left: 3px; top: 3px; background: white; border-radius: 50%; transition: 0.3s; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }
.toggle-wrap input:checked + .toggle-slider { background: var(--primary); }
.toggle-wrap input:checked + .toggle-slider::before { transform: translateX(20px); }
.remember-text { font-size: 14px; font-weight: 700; color: var(--text); }
.remember-hint { font-size: 12px; color: var(--success); font-weight: 600; transition: 0.3s; }
.remember-hint.off { color: var(--text-muted); }

/* Firebase note */
.firebase-setup-note { background: #fff3e0; border: 2px solid var(--primary); border-radius: 14px; padding: 16px; margin-bottom: 16px; font-size: 13px; line-height: 1.7; }
.firebase-setup-note strong { display: block; font-size: 15px; margin-bottom: 6px; color: var(--primary); }

/* â•â•â• FILTER BAR â•â•â• */
.filter-bar { display: flex; gap: 8px; overflow-x: auto; padding: 8px 18px 4px; scrollbar-width: none; }
.filter-bar::-webkit-scrollbar { display: none; }
.filter-chip { padding: 6px 14px; border-radius: 20px; border: 2px solid var(--border); background: white; font-family: inherit; font-size: 12px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: 0.2s; color: var(--text-muted); }
.filter-chip.active { background: var(--primary); color: white; border-color: var(--primary); }
.price-filter-row { display: flex; align-items: center; gap: 8px; padding: 6px 18px 10px; }
.price-filter-row input { width: 80px; padding: 6px 10px; border: 2px solid var(--border); border-radius: 8px; font-family: inherit; font-size: 13px; outline: none; background: white; }
.price-filter-row input:focus { border-color: var(--primary); }
.price-filter-row span { color: var(--text-muted); font-size: 13px; font-weight: 700; }
.price-filter-btn { padding: 6px 14px; border-radius: 8px; background: var(--primary); color: white; border: none; font-family: inherit; font-size: 13px; font-weight: 700; cursor: pointer; }

/* â•â•â• PRODUCT DETAIL MODAL â•â•â• */
.prod-detail-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.55); z-index: 2000; display: flex; align-items: flex-end; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
.prod-detail-modal.open { opacity: 1; pointer-events: all; }
.prod-detail-box { background: white; border-radius: 28px 28px 0 0; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; transform: translateY(100%); transition: 0.3s; }
.prod-detail-modal.open .prod-detail-box { transform: translateY(0); }
.prod-detail-img { width: 100%; height: 240px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 80px; border-radius: 28px 28px 0 0; overflow: hidden; position: relative; }
.prod-detail-img img { width: 100%; height: 100%; object-fit: cover; }
.prod-detail-close { position: absolute; top: 14px; right: 14px; background: rgba(0,0,0,0.45); color: white; border: none; border-radius: 50%; width: 36px; height: 36px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.prod-detail-body { padding: 22px 20px; }
.prod-detail-cat { font-size: 12px; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
.prod-detail-name { font-size: 22px; font-weight: 900; margin-bottom: 8px; line-height: 1.2; }
.prod-detail-prices { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
.prod-detail-price { font-size: 26px; font-weight: 900; color: var(--primary); }
.prod-detail-old { font-size: 16px; color: var(--text-muted); text-decoration: line-through; }
.prod-detail-desc { font-size: 14px; color: var(--text-muted); line-height: 1.7; margin-bottom: 18px; }
.prod-detail-trust { display: flex; gap: 14px; margin-bottom: 18px; flex-wrap: wrap; }
.trust-badge { display: flex; align-items: center; gap: 5px; font-size: 12px; font-weight: 700; color: var(--success); background: #f0fdf4; padding: 5px 10px; border-radius: 8px; }
.prod-detail-actions { display: flex; gap: 10px; }
.fav-btn-detail { background: none; border: 2px solid var(--border); border-radius: var(--radius-sm); padding: 13px 16px; font-size: 22px; cursor: pointer; transition: 0.2s; flex-shrink: 0; }
.fav-btn-detail.active { border-color: #ef4444; background: #fff5f5; }

/* â•â•â• STAR RATING / REVIEWS â•â•â• */
.stars-row { display: flex; align-items: center; gap: 4px; margin-bottom: 6px; }
.star { font-size: 18px; cursor: pointer; transition: 0.1s; opacity: 0.3; }
.star.filled { opacity: 1; }
.reviews-section { border-top: 1.5px solid var(--border); margin-top: 16px; padding-top: 16px; }
.reviews-title { font-size: 16px; font-weight: 900; margin-bottom: 12px; }
.review-card { background: var(--bg); border-radius: 12px; padding: 12px; margin-bottom: 10px; }
.review-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; }
.review-author { font-size: 13px; font-weight: 800; }
.review-date { font-size: 11px; color: var(--text-muted); }
.review-text { font-size: 13px; color: var(--text); line-height: 1.5; }
.review-stars { display: flex; gap: 2px; margin-bottom: 4px; }
.review-star { font-size: 13px; }
.add-review-form { background: var(--bg); border-radius: 14px; padding: 15px; margin-top: 12px; }
.add-review-title { font-size: 14px; font-weight: 800; margin-bottom: 10px; }
.rating-input { display: flex; gap: 6px; margin-bottom: 10px; }
.rating-star { font-size: 28px; cursor: pointer; opacity: 0.3; transition: 0.15s; }
.rating-star.active { opacity: 1; transform: scale(1.1); }
.review-textarea { width: 100%; padding: 10px 13px; border: 2px solid var(--border); border-radius: 10px; font-family: inherit; font-size: 14px; resize: none; outline: none; background: white; }
.review-textarea:focus { border-color: var(--primary); }

/* â•â•â• FAVORITES â•â•â• */
.fav-btn { position: absolute; top: 8px; right: 8px; background: white; border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.12); display: flex; align-items: center; justify-content: center; transition: 0.2s; z-index: 2; }
.fav-btn:hover { transform: scale(1.15); }
.product-img { position: relative; }

/* â•â•â• ORDER HISTORY (in profile) â•â•â• */
.order-hist-card { background: white; border-radius: var(--radius); padding: 14px; box-shadow: var(--shadow); margin-bottom: 11px; }
.order-hist-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.order-hist-id { font-size: 12px; font-weight: 800; color: var(--text-muted); }
.order-hist-total { font-size: 16px; font-weight: 900; color: var(--primary); }
.order-hist-items { font-size: 13px; color: var(--text-muted); margin-bottom: 5px; }
.order-hist-date { font-size: 11px; color: var(--text-muted); }

/* â•â•â• HELP/FAQ PAGE â•â•â• */
.faq-item { background: white; border-radius: var(--radius-sm); margin-bottom: 10px; box-shadow: var(--shadow); overflow: hidden; }
.faq-q { padding: 15px 16px; font-size: 14px; font-weight: 800; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
.faq-q .arrow { transition: 0.25s; font-size: 16px; color: var(--text-muted); }
.faq-item.open .faq-q .arrow { transform: rotate(90deg); }
.faq-a { padding: 0 16px; max-height: 0; overflow: hidden; transition: 0.3s; font-size: 13px; color: var(--text-muted); line-height: 1.7; }
.faq-item.open .faq-a { max-height: 200px; padding: 0 16px 14px; }
.contact-card { background: white; border-radius: var(--radius); padding: 18px; box-shadow: var(--shadow); margin-bottom: 12px; }
.contact-card-title { font-size: 15px; font-weight: 900; margin-bottom: 13px; }
.contact-row { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); cursor: pointer; }
.contact-row:last-child { border: none; }
.contact-icon { font-size: 24px; }
.contact-info { flex: 1; }
.contact-label { font-size: 12px; color: var(--text-muted); font-weight: 700; }
.contact-value { font-size: 14px; font-weight: 800; }

/* â•â•â• SECURITY BADGES â•â•â• */
.security-bar { background: #f0fdf4; border: 1.5px solid #86efac; border-radius: 12px; padding: 10px 14px; display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.security-bar-icon { font-size: 20px; }
.security-bar-text { font-size: 12px; font-weight: 700; color: #166534; line-height: 1.4; }

/* â•â•â• WEEKLY SCROLL ROW â•â•â• */
.weekly-scroll { display: flex; gap: 13px; overflow-x: auto; padding-bottom: 8px; scrollbar-width: none; }
.weekly-scroll::-webkit-scrollbar { display: none; }
.weekly-scroll .product-card { min-width: 155px; flex-shrink: 0; }

/* â•â•â• ALL PRODUCTS PAGINATION â•â•â• */
.paginate-row { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 18px; }
.page-btn { width: 36px; height: 36px; border-radius: 10px; border: 2px solid var(--border); background: white; font-family: inherit; font-size: 14px; font-weight: 800; cursor: pointer; transition: 0.2s; color: var(--text); display: flex; align-items: center; justify-content: center; }
.page-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
.page-btn:hover:not(.active) { border-color: var(--primary); color: var(--primary); }
.page-btn:disabled { opacity: 0.3; cursor: not-allowed; }

/* â•â•â• FILTER MODAL (sort + price hidden in dropdown) â•â•â• */
.filter-modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.45); z-index: 1500; opacity: 0; pointer-events: none; transition: 0.25s; }
.filter-modal-bg.open { opacity: 1; pointer-events: all; }
.filter-modal-box { position: absolute; bottom: 0; left: 0; right: 0; background: white; border-radius: 24px 24px 0 0; padding: 22px 20px 30px; transform: translateY(100%); transition: 0.3s; }
.filter-modal-bg.open .filter-modal-box { transform: translateY(0); }
.filter-modal-title { font-size: 17px; font-weight: 900; margin-bottom: 16px; display: flex; justify-content: space-between; }
.fm-section { margin-bottom: 18px; }
.fm-label { font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
.fm-price-row { display: flex; align-items: center; gap: 10px; }
.fm-price-row input { flex: 1; padding: 10px 13px; border: 2px solid var(--border); border-radius: 10px; font-family: inherit; font-size: 14px; outline: none; }
.fm-price-row input:focus { border-color: var(--primary); }
.fm-sort-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.fm-sort-btn { padding: 10px; border-radius: 10px; border: 2px solid var(--border); background: white; font-family: inherit; font-size: 13px; font-weight: 700; cursor: pointer; transition: 0.2s; color: var(--text-muted); text-align: center; }
.fm-sort-btn.active { border-color: var(--primary); color: var(--primary); background: #fff8f0; }

/* â•â•â• EDIT PROFILE MODAL â•â•â• */
.edit-profile-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: flex-end; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
.edit-profile-modal.open { opacity: 1; pointer-events: all; }
.edit-profile-box { background: white; border-radius: 24px 24px 0 0; width: 100%; max-width: 500px; padding: 24px 22px 36px; transform: translateY(100%); transition: 0.3s; }
.edit-profile-modal.open .edit-profile-box { transform: translateY(0); }

/* â•â•â• FAV BUTTON ON CARD â•â•â• */
.product-img { position: relative; }
.fav-btn { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.85); border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
.fav-btn:hover { background: white; transform: scale(1.1); }

/* â•â•â• ORDER HISTORY CARD â•â•â• */
.order-hist-card { background: white; border-radius: var(--radius); padding: 15px; box-shadow: var(--shadow); margin-bottom: 12px; }
.order-hist-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.order-hist-id { font-weight: 900; font-size: 14px; }
.order-hist-items { font-size: 13px; color: var(--text-muted); margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.order-hist-date { font-size: 12px; color: var(--text-muted); }
.order-hist-total { font-weight: 900; font-size: 15px; color: var(--primary); }

/* â•â•â• REVIEW & RATING STARS â•â•â• */
.review-stars { font-size: 14px; margin-bottom: 5px; }
.rating-input { display: flex; gap: 6px; margin-bottom: 10px; }
.rating-star { font-size: 26px; cursor: pointer; opacity: 0.3; transition: 0.15s; }
.rating-star.active { opacity: 1; }
.add-review-form { margin-top: 16px; border-top: 1.5px solid var(--border); padding-top: 16px; }
.add-review-title { font-size: 15px; font-weight: 900; margin-bottom: 10px; }
.review-textarea { width: 100%; padding: 11px 14px; border: 2px solid var(--border); border-radius: var(--radius-sm); font-family: inherit; font-size: 14px; color: var(--text); background: #fafafa; outline: none; resize: none; transition: 0.2s; }
.review-textarea:focus { border-color: var(--primary); background: white; }
</style>
</head>
<body>

<!-- LOADING -->
<div id="loadingOverlay">
  <div class="spinner"></div>
  <span class="loading-text">YÃ¼kleniyor...</span>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- PWA INSTALL BANNER -->
<div class="pwa-banner" id="pwaBanner" style="display:none">
  <span class="pwa-icon">ğŸ›’</span>
  <div class="pwa-text">
    <strong>Ana Ekrana Ekle</strong>
    <span>Uygulama gibi kullanmak iÃ§in ekrana ekle!</span>
  </div>
  <button class="pwa-btn" id="pwaInstallBtn">Ekle</button>
  <button class="pwa-close" onclick="document.getElementById('pwaBanner').style.display='none'">âœ•</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• LOGIN SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen" class="screen active">
  <div class="login-card">
    <div class="login-logo">
      <img src="https://i.imgur.com/placeholder.png" alt="AS-MAR"
           onerror="this.style.display='none'; document.querySelector('.login-logo-fallback').style.display='block'">
      <div class="login-logo-fallback">ğŸ›’ AS-MAR</div>
    </div>
    <h1 class="login-title" id="authTitle">HoÅŸ Geldiniz</h1>
    <p class="login-sub">GÃ¼mrÃ¼k LojmanlarÄ± sakinlerine Ã¶zel kapÄ±ya teslimat hizmeti.</p>
    <div class="login-info">ğŸšš TÃ¼m bloklara ve dairelere Ã¼cretsiz, hÄ±zlÄ± teslimat!</div>

    <!-- REGISTER ONLY FIELDS -->
    <div id="regFields" style="display:none">
      <div class="form-group"><label>Ad Soyad</label><input type="text" id="regName" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z"></div>
      <div class="form-group"><label>Telefon</label><input type="tel" id="regPhone" placeholder="05XX XXX XX XX"></div>
    </div>

    <div class="form-group"><label>E-posta</label><input type="email" id="authEmail" placeholder="ornek@mail.com"></div>
    <div class="form-group"><label>Åifre</label><input type="password" id="authPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter') handleAuth()"></div>

    <div id="regAddrFields" style="display:none">
      <div class="addr-grid">
        <div class="form-group"><label>Blok</label>
          <select id="regBlock"><option value="">SeÃ§iniz</option></select>
        </div>
        <div class="form-group"><label>Daire No</label><input type="number" id="regFlat" placeholder="12"></div>
      </div>
    </div>

    <div id="rememberMeRow" class="remember-me-row">
      <label class="remember-label">
        <div class="toggle-wrap">
          <input type="checkbox" id="rememberMe" checked>
          <span class="toggle-slider"></span>
        </div>
        <span class="remember-text">Oturumu aÃ§Ä±k tut</span>
      </label>
      <span class="remember-hint" id="rememberHint">âœ“ Bir daha giriÅŸ yapmanÄ±za gerek kalmaz</span>
    </div>

    <button class="btn btn-primary" id="authBtn" onclick="handleAuth()">GiriÅŸ Yap</button>
    <div class="login-switch">
      <span id="switchTxt">HenÃ¼z hesabÄ±nÄ±z yok mu?</span>
      <a id="switchLnk" onclick="toggleMode()"> KayÄ±t Ol</a>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mainApp" class="screen">
  <div class="topbar">
    <div class="topbar-logo">
      <img src="https://i.imgur.com/placeholder.png" alt="AS-MAR" style="height:40px;border-radius:8px"
           onerror="this.outerHTML='<span style=\'font-size:20px;font-weight:900;color:var(--primary)\'>ğŸ›’ AS-MAR</span>'">
    </div>
    <div class="topbar-right">
      <div class="user-info" id="userInfoDisplay"></div>
      <button class="cart-btn" onclick="switchPage('cart')">ğŸ›’
        <span class="cart-badge" id="cartBadge">0</span>
      </button>
    </div>
  </div>

  <div style="flex:1;overflow:hidden;display:flex;flex-direction:column">
    <!-- HOME -->
    <div class="page active" id="page-home">
      <div class="delivery-strip">ğŸ“ Teslimat: <strong>GÃ¼mrÃ¼k LojmanlarÄ±</strong>&nbsp;â€¢ ÃœCRETSÄ°Z â€¢ <span id="deliveryBadge">15-30</span> dk</div>
      <div class="search-wrap">
        <div class="search-box">
          <span>ğŸ”</span>
          <input type="text" id="homeSearch" placeholder="ÃœrÃ¼n veya marka ara..." oninput="filterSearch()">
          <button onclick="clearSearch()" style="background:none;border:none;font-size:18px;cursor:pointer;color:var(--text-muted);padding:0" id="clearSearchBtn" title="Temizle">âœ•</button>
        </div>
      </div>
      <!-- FILTER CHIPS + FILTER BUTTON -->
      <div style="display:flex;align-items:center;gap:0">
        <div class="filter-bar" id="filterBar" style="flex:1">
          <button class="filter-chip active" onclick="setFilter('all',this)">TÃ¼mÃ¼</button>
          <button class="filter-chip" onclick="setFilter('weekly',this)">â­ Ä°ndirimli</button>
          <button class="filter-chip" onclick="setFilter('Ä°Ã§ecek',this)">ğŸ¥¤ Ä°Ã§ecek</button>
          <button class="filter-chip" onclick="setFilter('SÃ¼tlÃ¼k',this)">ğŸ¥› SÃ¼tlÃ¼k</button>
          <button class="filter-chip" onclick="setFilter('Mutfak',this)">ğŸ³ Mutfak</button>
          <button class="filter-chip" onclick="setFilter('Temizlik',this)">ğŸ§´ Temizlik</button>
          <button class="filter-chip" onclick="setFilter('Manav',this)">ğŸ¥¦ Manav</button>
          <button class="filter-chip" onclick="setFilter('Kasap',this)">ğŸ¥© Kasap</button>
          <button class="filter-chip" onclick="setFilter('DondurulmuÅŸ',this)">â„ï¸ DondurulmuÅŸ</button>
          <button class="filter-chip" onclick="setFilter('AtÄ±ÅŸtÄ±rmalÄ±k',this)">ğŸ« AtÄ±ÅŸtÄ±rmalÄ±k</button>
        </div>
        <button onclick="openFilterModal()" style="background:none;border:none;padding:8px 14px 8px 4px;cursor:pointer;font-size:22px;flex-shrink:0" title="Filtrele & SÄ±rala">âš™ï¸</button>
      </div>
      <div class="section">
        <div class="sec-header"><span class="sec-title">Kategoriler</span><button class="see-all" onclick="switchPage('categories')">TÃ¼mÃ¼</button></div>
        <div class="cats-row" id="homeCats"></div>
      </div>
      <div class="hero">
        <div class="hero-badge">GÃœMRÃœK LOJMANLARINA Ã–ZEL</div>
        <div class="hero-title">HÄ±zlÄ± KapÄ±da! ğŸš€</div>
        <div class="hero-sub">Dairenize kadar teslimat, hiÃ§bir Ã¼cret farkÄ± Ã¶demeden.</div>
        <button class="hero-cta" onclick="switchPage('categories')">Åimdi Al</button>
      </div>
      <!-- WEEKLY: horizontal scroll -->
      <div class="section" id="weeklySec">
        <div class="sec-header">
          <span class="sec-title">HaftanÄ±n ÃœrÃ¼nleri <span class="sale-tag">Ä°NDÄ°RÄ°M</span></span>
        </div>
        <div class="weekly-scroll" id="weeklyGrid"></div>
      </div>
      <!-- ALL PRODUCTS: always visible, paginated -->
      <div class="section" id="allProductsSec">
        <div class="sec-header"><span class="sec-title" id="allProdTitle">TÃ¼m ÃœrÃ¼nler</span><span id="allProdCount" style="font-size:12px;color:var(--text-muted);font-weight:700"></span></div>
        <div class="products-grid" id="allProdGrid"></div>
        <div class="paginate-row" id="paginateRow" style="display:none"></div>
      </div>
    </div>

    <!-- CATEGORIES -->
    <div class="page" id="page-categories">
      <div class="cat-full-grid" id="catFullGrid"></div>
      <div id="catProdView" style="display:none">
        <div class="page-header">
          <button class="back-btn" onclick="closeCatView()">â†</button>
          <span class="page-title" id="catViewTitle"></span>
        </div>
        <div style="padding:14px 18px">
          <div class="products-grid" id="catProdGrid"></div>
        </div>
      </div>
    </div>

    <!-- CART -->
    <div class="page" id="page-cart">
      <div class="page-header"><span class="page-title">ğŸ›’ Sepetim</span></div>
      <div id="cartEmpty" class="empty" style="display:none">
        <div class="empty-icon">ğŸ›’</div>
        <div class="empty-title">Sepetiniz boÅŸ</div>
        <p>AlÄ±ÅŸveriÅŸe baÅŸlamak iÃ§in Ã¼rÃ¼n ekleyin</p>
        <br><button class="btn btn-primary" onclick="switchPage('home')" style="width:auto;padding:12px 28px">AlÄ±ÅŸveriÅŸe BaÅŸla</button>
      </div>
      <div id="cartFull">
        <div class="cart-list" id="cartList"></div>
        <div class="cart-total-box" id="cartTotalBox"></div>
      </div>
    </div>

    <!-- CHECKOUT -->
    <div class="page" id="page-checkout">
      <div class="page-header">
        <button class="back-btn" onclick="switchPage('cart')">â†</button>
        <span class="page-title">Ã–deme ve Adres</span>
      </div>
      <div class="checkout-wrap">
        <div class="security-bar">
          <span class="security-bar-icon">ğŸ”’</span>
          <div class="security-bar-text">SSL ile ÅŸifrelenmiÅŸ gÃ¼venli baÄŸlantÄ± Â· Bilgileriniz korunmaktadÄ±r</div>
        </div>
        <div class="checkout-card">
          <div class="checkout-card-title">ğŸ“ Teslimat Adresi</div>
          <p style="font-size:13px;color:var(--text-muted);margin-bottom:13px">YalnÄ±zca GÃ¼mrÃ¼k LojmanlarÄ±'na teslimat yapÄ±lmaktadÄ±r.</p>
          <div class="addr-grid">
            <div class="form-group"><label>Blok SeÃ§imi</label><select id="coBlock"></select></div>
            <div class="form-group"><label>Daire No</label><input type="number" id="coFlat" placeholder="Ã–rn: 12"></div>
          </div>
          <div class="form-group">
            <label>Not (Opsiyonel)</label>
            <textarea id="coNote" rows="3" placeholder="Zile basmayÄ±n, kapÄ±ya bÄ±rakÄ±n..." style="resize:none"></textarea>
          </div>
        </div>
        <div class="checkout-card">
          <div class="checkout-card-title">ğŸ’³ Ã–deme YÃ¶ntemi</div>
          <div class="pay-opt selected" id="pay-cash" onclick="selPay('cash')">
            <div class="radio-dot"></div><span class="pay-icon">ğŸ¦</span>
            <div><div class="pay-label">KapÄ±da Ã–deme (Nakit/Kart)</div><div class="pay-sub">ÃœrÃ¼nÃ¼ teslim alÄ±rken Ã¶deyin</div></div>
          </div>
          <div class="pay-opt" id="pay-iban" onclick="selPay('iban')">
            <div class="radio-dot"></div><span class="pay-icon">ğŸ§</span>
            <div><div class="pay-label">IBAN ile Ã–deme</div><div class="pay-sub">Havale / EFT ile Ã¶n Ã¶deme yapÄ±n</div></div>
          </div>
          <div class="iban-info" id="ibanInfoBox"></div>
        </div>
        <div class="checkout-card">
          <div class="checkout-card-title">ğŸ“¦ SipariÅŸ Ã–zeti</div>
          <div id="coOrderSummary"></div>
        </div>
      </div>
      <div class="sticky-pay">
        <div class="sticky-row">
          <span style="font-size:14px;color:var(--text-muted)">Toplam Ã–denecek</span>
          <span style="font-size:18px;font-weight:900;color:var(--primary)" id="coTotal">â‚º0,00</span>
        </div>
        <div style="text-align:right;font-size:12px;color:var(--success);font-weight:700;margin-bottom:8px">
          âœ… ÃœCRETSÄ°Z TESLÄ°MAT &nbsp;â€¢ Tahmini: <span id="coDeliveryTime">15-30</span> dk
        </div>
        <button class="btn btn-primary" onclick="placeOrder()">SipariÅŸi Tamamla â†’</button>
      </div>
    </div>

    <!-- PROFILE -->
    <div class="page" id="page-profile">
      <div class="profile-wrap">
        <div class="profile-hero">
          <div class="p-avatar">ğŸ‘¤</div>
          <div class="p-name" id="profileName">KullanÄ±cÄ±</div>
          <div class="p-email" id="profileEmail"></div>
        </div>
        <div class="menu-row" onclick="openEditProfile()"><span class="menu-row-icon">ğŸ“</span><span class="menu-row-text">Adresim: <span id="profileAddr">â€”</span></span><span style="font-size:12px;color:var(--primary);font-weight:800">DÃ¼zenle â€º</span></div>
        <div class="menu-row" onclick="openEditProfile()"><span class="menu-row-icon">ğŸ“</span><span class="menu-row-text">Telefon: <span id="profilePhone">â€”</span></span><span style="font-size:12px;color:var(--primary);font-weight:800">DÃ¼zenle â€º</span></div>
        <div class="menu-row" onclick="switchPage('favorites')"><span class="menu-row-icon">â¤ï¸</span><span class="menu-row-text">Favorilerim</span><span>â€º</span></div>
        <div class="menu-row" onclick="switchPage('orders-history')"><span class="menu-row-icon">ğŸ“¦</span><span class="menu-row-text">SipariÅŸ GeÃ§miÅŸim</span><span>â€º</span></div>
        <div class="menu-row" onclick="switchPage('help')"><span class="menu-row-icon">â“</span><span class="menu-row-text">YardÄ±m & SSS</span><span>â€º</span></div>
        <div class="menu-row" onclick="doLogout()"><span class="menu-row-icon">ğŸšª</span><span class="menu-row-text" style="color:var(--danger)">Ã‡Ä±kÄ±ÅŸ Yap</span><span>â€º</span></div>
      </div>
    </div>

    <!-- FAVORITES PAGE -->
    <div class="page" id="page-favorites">
      <div class="page-header">
        <button class="back-btn" onclick="switchPage('profile')">â†</button>
        <span class="page-title">â¤ï¸ Favorilerim</span>
      </div>
      <div style="padding:14px 18px">
        <div id="favGrid" class="products-grid"></div>
        <div id="favEmpty" class="empty" style="display:none">
          <div class="empty-icon">â¤ï¸</div>
          <div class="empty-title">Favori Ã¼rÃ¼nÃ¼nÃ¼z yok</div>
          <p>ÃœrÃ¼nlerdeki â¤ï¸ butonuna basarak favorilerinize ekleyin</p>
        </div>
      </div>
    </div>

    <!-- ORDER HISTORY PAGE -->
    <div class="page" id="page-orders-history">
      <div class="page-header">
        <button class="back-btn" onclick="switchPage('profile')">â†</button>
        <span class="page-title">ğŸ“¦ SipariÅŸ GeÃ§miÅŸim</span>
      </div>
      <div style="padding:14px 18px">
        <div id="orderHistList"></div>
        <div id="orderHistEmpty" class="empty" style="display:none">
          <div class="empty-icon">ğŸ“¦</div>
          <div class="empty-title">HenÃ¼z sipariÅŸiniz yok</div>
          <p>Ä°lk sipariÅŸinizi verin!</p>
          <br><button class="btn btn-primary" onclick="switchPage('home')" style="width:auto;padding:12px 28px">AlÄ±ÅŸveriÅŸe BaÅŸla</button>
        </div>
      </div>
    </div>

    <!-- HELP & FAQ PAGE -->
    <div class="page" id="page-help">
      <div class="page-header">
        <button class="back-btn" onclick="switchPage('profile')">â†</button>
        <span class="page-title">â“ YardÄ±m & SSS</span>
      </div>
      <div style="padding:14px 18px">
        <div class="contact-card">
          <div class="contact-card-title">ğŸ“ Ä°letiÅŸim</div>
          <div class="contact-row" onclick="window.open('tel:+905001234567')">
            <span class="contact-icon">ğŸ“±</span>
            <div class="contact-info"><div class="contact-label">Telefon</div><div class="contact-value">0500 123 45 67</div></div>
            <span style="color:var(--text-muted)">â€º</span>
          </div>
          <div class="contact-row" onclick="window.open('https://wa.me/905001234567')">
            <span class="contact-icon">ğŸ’¬</span>
            <div class="contact-info"><div class="contact-label">WhatsApp</div><div class="contact-value">HÄ±zlÄ± Destek</div></div>
            <span style="color:var(--text-muted)">â€º</span>
          </div>
          <div class="contact-row" onclick="window.open('mailto:destek@asmar.com')">
            <span class="contact-icon">ğŸ“§</span>
            <div class="contact-info"><div class="contact-label">E-posta</div><div class="contact-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fe9a9b8d8a9b95be9f8d939f8cd09d9193">[email&#160;protected]</a></div></div>
            <span style="color:var(--text-muted)">â€º</span>
          </div>
        </div>
        <div style="font-size:16px;font-weight:900;margin-bottom:12px">ğŸ’¡ SÄ±k Sorulan Sorular</div>
        <div class="faq-item" onclick="toggleFaq(this)">
          <div class="faq-q">Teslimat Ã¼creti var mÄ±? <span class="arrow">â€º</span></div>
          <div class="faq-a">HayÄ±r! GÃ¼mrÃ¼k LojmanlarÄ±'ndaki tÃ¼m dairelere tamamen Ã¼cretsiz teslimat yapÄ±yoruz. HiÃ§bir gizli Ã¼cret yoktur.</div>
        </div>
        <div class="faq-item" onclick="toggleFaq(this)">
          <div class="faq-q">Teslimat ne kadar sÃ¼rer? <span class="arrow">â€º</span></div>
          <div class="faq-a">SipariÅŸleriniz genellikle 15-30 dakika iÃ§inde kapÄ±nÄ±za ulaÅŸÄ±r. YoÄŸun saatlerde bu sÃ¼re biraz uzayabilir.</div>
        </div>
        <div class="faq-item" onclick="toggleFaq(this)">
          <div class="faq-q">Hangi Ã¶deme yÃ¶ntemleri kabul ediliyor? <span class="arrow">â€º</span></div>
          <div class="faq-a">KapÄ±da nakit, kapÄ±da kredi/banka kartÄ± ve IBAN ile Ã¶n Ã¶deme (havale/EFT) seÃ§enekleri mevcuttur.</div>
        </div>
        <div class="faq-item" onclick="toggleFaq(this)">
          <div class="faq-q">SipariÅŸimi iptal edebilir miyim? <span class="arrow">â€º</span></div>
          <div class="faq-a">SipariÅŸiniz hazÄ±rlanmaya baÅŸlamadan Ã¶nce WhatsApp veya telefon Ã¼zerinden bize ulaÅŸarak iptal edebilirsiniz.</div>
        </div>
        <div class="faq-item" onclick="toggleFaq(this)">
          <div class="faq-q">ÃœrÃ¼n deÄŸiÅŸimi veya iadesi? <span class="arrow">â€º</span></div>
          <div class="faq-a">HatalÄ± veya hasarlÄ± Ã¼rÃ¼n teslimatÄ± durumunda aynÄ± gÃ¼n iÃ§inde deÄŸiÅŸim yapÄ±lmaktadÄ±r. Bizimle iletiÅŸime geÃ§in.</div>
        </div>
        <div class="faq-item" onclick="toggleFaq(this)">
          <div class="faq-q">Sadece lojman sakinlerine mi hizmet veriyorsunuz? <span class="arrow">â€º</span></div>
          <div class="faq-a">Åu an iÃ§in evet. AS-MAR olarak yalnÄ±zca GÃ¼mrÃ¼k LojmanlarÄ± sakinlerine kapÄ±da teslimat hizmeti sunmaktayÄ±z.</div>
        </div>
        <div style="background: #fff8f0; border: 1.5px solid var(--primary); border-radius: 14px; padding: 16px; margin-top: 16px; text-align:center;">
          <div style="font-size:28px;margin-bottom:6px">ğŸ”’</div>
          <div style="font-size:14px;font-weight:900;margin-bottom:4px">GÃ¼venli AlÄ±ÅŸveriÅŸ</div>
          <div style="font-size:12px;color:var(--text-muted);line-height:1.6">TÃ¼m baÄŸlantÄ±larÄ±mÄ±z SSL ile ÅŸifrelenmiÅŸtir. KiÅŸisel bilgileriniz 3. ÅŸahÄ±slarla paylaÅŸÄ±lmaz.</div>
        </div>
      </div>
    </div>

  </div>

  <div class="bottom-nav">
    <button class="nav-item active" id="nav-home" onclick="switchPage('home')"><span class="nav-icon">ğŸ </span>Ana Sayfa</button>
    <button class="nav-item" id="nav-categories" onclick="switchPage('categories')"><span class="nav-icon">ğŸ“‹</span>Kategoriler</button>
    <button class="nav-item" id="nav-cart" onclick="switchPage('cart')"><span class="nav-icon">ğŸ›’</span>Sepetim</button>
    <button class="nav-item" id="nav-profile" onclick="switchPage('profile')"><span class="nav-icon">ğŸ‘¤</span>Profil</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• ADMIN SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
<div id="adminScreen" class="screen">
  <div class="adm-topbar">
    <div class="adm-logo">
      <img src="https://i.imgur.com/placeholder.png" alt="AS-MAR"
           onerror="this.style.display='none'">
      <div>
        <div class="adm-logo-txt">AS-MAR</div>
        <div class="adm-logo-sub">ADMÄ°N PANELÄ°</div>
      </div>
    </div>
    <button class="btn btn-outline btn-sm" onclick="doLogout()">Ã‡Ä±kÄ±ÅŸ</button>
  </div>
  <div class="adm-nav">
    <button class="adm-nav-btn active" onclick="switchAdm('dashboard',this)">ğŸ“Š Panel</button>
    <button class="adm-nav-btn" onclick="switchAdm('products',this)">ğŸ“¦ ÃœrÃ¼nler</button>
    <button class="adm-nav-btn" onclick="switchAdm('addProduct',this)">â• ÃœrÃ¼n Ekle</button>
    <button class="adm-nav-btn" onclick="switchAdm('orders',this)">ğŸšš SipariÅŸler</button>
    <button class="adm-nav-btn" onclick="switchAdm('settings',this)">âš™ï¸ Ayarlar</button>
  </div>

  <!-- Dashboard -->
  <div class="adm-page active" id="adm-dashboard">
    <div class="stats-row">
      <div class="stat-box"><div class="stat-box-icon">ğŸ“¦</div><div class="stat-box-label">ÃœrÃ¼n</div><div class="stat-box-val" id="stProducts">0</div></div>
      <div class="stat-box"><div class="stat-box-icon">ğŸ†•</div><div class="stat-box-label">Yeni SipariÅŸ</div><div class="stat-box-val" id="stNewOrders">0</div></div>
      <div class="stat-box"><div class="stat-box-icon">ğŸ“‹</div><div class="stat-box-label">Toplam</div><div class="stat-box-val" id="stTotalOrders">0</div></div>
    </div>
    <button class="btn btn-primary" onclick="switchAdm('addProduct', document.querySelectorAll('.adm-nav-btn')[2])" style="margin-bottom:16px">â• Yeni ÃœrÃ¼n Ekle</button>
    <div class="adm-card">
      <div class="adm-card-title">Son ÃœrÃ¼nler <button class="see-all" onclick="switchAdm('products', document.querySelectorAll('.adm-nav-btn')[1])">TÃ¼mÃ¼nÃ¼ GÃ¶r</button></div>
      <div id="dashProdList"></div>
    </div>
  </div>

  <!-- Products -->
  <div class="adm-page" id="adm-products">
    <div class="form-group" style="margin-bottom:10px">
      <input type="text" placeholder="ğŸ” ÃœrÃ¼nlerde ara..." id="admSearch" oninput="renderAdmProducts()">
    </div>
    <div id="admProductList"></div>
  </div>

  <!-- Add/Edit Product -->
  <div class="adm-page" id="adm-addProduct">
    <div class="adm-card">
      <div class="adm-card-title" id="addProdTitle">â• Yeni ÃœrÃ¼n Ekle</div>
      <div class="img-prev" id="imgPrev">ğŸ–¼ï¸</div>
      <div class="img-tabs">
        <button class="img-tab active" onclick="setImgTab('url',this)">ğŸ”— URL YapÄ±ÅŸtÄ±r</button>
        <button class="img-tab" onclick="setImgTab('upload',this)">ğŸ“ Dosya YÃ¼kle</button>
      </div>
      <div id="imgUrlGrp" class="form-group">
        <label>GÃ¶rsel URL</label>
        <input type="url" id="pImgUrl" placeholder="https://example.com/resim.jpg" oninput="prevImgUrl()">
      </div>
      <div id="imgFileGrp" class="form-group" style="display:none">
        <label>GÃ¶rsel YÃ¼kle</label>
        <input type="file" id="pImgFile" accept="image/*" onchange="prevImgFile()">
      </div>
      <div class="form-group"><label>ÃœrÃ¼n AdÄ± *</label><input type="text" id="pName" placeholder="Tam YaÄŸlÄ± SÃ¼t 1L"></div>
      <div class="form-group"><label>Kategori *</label>
        <select id="pCat">
          <option value="Ä°Ã§ecek">ğŸ¥¤ Ä°Ã§ecek</option>
          <option value="SÃ¼tlÃ¼k">ğŸ¥› SÃ¼tlÃ¼k</option>
          <option value="Mutfak">ğŸ³ Mutfak</option>
          <option value="Temizlik">ğŸ§´ Temizlik</option>
          <option value="Manav">ğŸ¥¦ Manav</option>
          <option value="Kasap">ğŸ¥© Kasap</option>
          <option value="DondurulmuÅŸ">â„ï¸ DondurulmuÅŸ ÃœrÃ¼nler</option>
          <option value="AtÄ±ÅŸtÄ±rmalÄ±k">ğŸ« AtÄ±ÅŸtÄ±rmalÄ±k</option>
        </select>
      </div>
      <div class="addr-grid">
        <div class="form-group"><label>Yeni Fiyat (â‚º) *</label><input type="number" id="pPrice" placeholder="32.50" step="0.01" min="0"></div>
        <div class="form-group"><label>Eski Fiyat (â‚º)</label><input type="number" id="pOldPrice" placeholder="35.00" step="0.01" min="0"></div>
      </div>
      <div class="form-group"><label>AÃ§Ä±klama</label><textarea id="pDesc" rows="3" placeholder="ÃœrÃ¼n aÃ§Ä±klamasÄ±..." style="resize:none"></textarea></div>
      <label class="checkbox-row"><input type="checkbox" id="pWeekly"> â­ HaftanÄ±n ÃœrÃ¼nÃ¼ olarak iÅŸaretle</label>
      <div style="display:flex;gap:10px">
        <button class="btn btn-primary" onclick="saveProd()">ğŸ’¾ Kaydet</button>
        <button class="btn btn-outline" onclick="clearProdForm()">âœ– Temizle</button>
      </div>
    </div>
  </div>

  <!-- Orders -->
  <div class="adm-page" id="adm-orders">
    <div id="admOrderList"></div>
  </div>

  <!-- Settings -->
  <div class="adm-page" id="adm-settings">
    <div class="adm-card">
      <div class="adm-card-title">ğŸ’³ Ã–deme AyarlarÄ±</div>
      <div class="form-group"><label>IBAN NumarasÄ±</label><input type="text" id="setIban" placeholder="TR00 0000 0000 0000 0000 0000 00"></div>
      <div class="form-group"><label>Hesap Sahibi AdÄ±</label><input type="text" id="setIbanName" placeholder="AS-MAR AlÄ±ÅŸveriÅŸ Merkezi"></div>
    </div>
    <div class="adm-card">
      <div class="adm-card-title">â±ï¸ Teslimat SÃ¼resi</div>
      <div class="form-group"><label>Tahmini SÃ¼re</label><input type="text" id="setDelivery" placeholder="15-30"></div>
    </div>
    <div class="adm-card">
      <div class="adm-card-title">ğŸ¢ Blok YÃ¶netimi</div>
      <div id="blockList"></div>
      <div class="block-add-row">
        <input type="text" id="newBlockInput" placeholder="Yeni blok harfi (Ã–rn: G)" maxlength="3">
        <button class="btn btn-primary btn-sm" onclick="addBlock()">â• Ekle</button>
      </div>
    </div>
    <div class="adm-card">
      <div class="adm-card-title">ğŸ“‹ Daire NumarasÄ± AralÄ±ÄŸÄ±</div>
      <div class="addr-grid">
        <div class="form-group"><label>Min Daire No</label><input type="number" id="setFlatMin" placeholder="1"></div>
        <div class="form-group"><label>Max Daire No</label><input type="number" id="setFlatMax" placeholder="50"></div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ AyarlarÄ± Kaydet</button>
  </div>
</div>

<!-- FILTER & SORT MODAL -->
<div class="filter-modal-bg" id="filterModalBg" onclick="closeFilterModal(event)">
  <div class="filter-modal-box">
    <div class="filter-modal-title">
      <span>âš™ï¸ Filtrele & SÄ±rala</span>
      <button onclick="closeFilterModal()" style="background:none;border:none;font-size:22px;cursor:pointer">âœ•</button>
    </div>
    <div class="fm-section">
      <div class="fm-label">Fiyat AralÄ±ÄŸÄ±</div>
      <div class="fm-price-row">
        <input type="number" id="priceMin" placeholder="Min â‚º" min="0">
        <span style="font-weight:800;color:var(--text-muted)">â€”</span>
        <input type="number" id="priceMax" placeholder="Max â‚º" min="0">
      </div>
    </div>
    <div class="fm-section">
      <div class="fm-label">SÄ±ralama</div>
      <div class="fm-sort-grid">
        <button class="fm-sort-btn active" onclick="setSortFilter('default',this)">VarsayÄ±lan</button>
        <button class="fm-sort-btn" onclick="setSortFilter('price_asc',this)">ğŸ’° Ucuzdan PahalÄ±ya</button>
        <button class="fm-sort-btn" onclick="setSortFilter('price_desc',this)">ğŸ’ PahalÄ±dan Ucuza</button>
        <button class="fm-sort-btn" onclick="setSortFilter('name_asc',this)">ğŸ”¤ A â†’ Z</button>
      </div>
    </div>
    <div style="display:flex;gap:10px;margin-top:4px">
      <button class="btn btn-outline" onclick="resetFilters()" style="flex:1;padding:12px">SÄ±fÄ±rla</button>
      <button class="btn btn-primary" onclick="applyFilterModal()" style="flex:2;padding:12px">Uygula âœ“</button>
    </div>
  </div>
</div>

<!-- EDIT PROFILE MODAL -->
<div class="edit-profile-modal" id="editProfileModal">
  <div class="edit-profile-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
      <span style="font-size:18px;font-weight:900">âœï¸ Bilgileri DÃ¼zenle</span>
      <button onclick="closeEditProfile()" style="background:var(--bg);border:none;border-radius:50%;width:34px;height:34px;font-size:18px;cursor:pointer">âœ•</button>
    </div>
    <div class="form-group"><label>Ad Soyad</label><input type="text" id="epName" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z"></div>
    <div class="form-group"><label>Telefon</label><input type="tel" id="epPhone" placeholder="05XX XXX XX XX"></div>
    <div class="addr-grid">
      <div class="form-group"><label>Blok</label><select id="epBlock"></select></div>
      <div class="form-group"><label>Daire No</label><input type="number" id="epFlat" placeholder="12"></div>
    </div>
    <button class="btn btn-primary" onclick="saveProfile()">ğŸ’¾ Kaydet</button>
  </div>
</div>

<!-- PRODUCT DETAIL MODAL -->
<div class="prod-detail-modal" id="prodDetailModal">
  <div class="prod-detail-box">
    <div class="prod-detail-img" id="pdImg">
      <button class="prod-detail-close" onclick="closeProdDetail()">âœ•</button>
    </div>
    <div class="prod-detail-body">
      <div class="prod-detail-cat" id="pdCat"></div>
      <div class="prod-detail-name" id="pdName"></div>
      <div class="prod-detail-prices">
        <span class="prod-detail-price" id="pdPrice"></span>
        <span class="prod-detail-old" id="pdOld"></span>
      </div>
      <div class="prod-detail-trust">
        <div class="trust-badge">âœ… Ãœcretsiz Teslimat</div>
        <div class="trust-badge">âš¡ 15-30 dk</div>
        <div class="trust-badge">ğŸ”’ GÃ¼venli</div>
      </div>
      <div class="prod-detail-desc" id="pdDesc"></div>
      <!-- AVG RATING -->
      <div id="pdRatingSummary" style="margin-bottom:14px"></div>
      <div class="prod-detail-actions">
        <button class="fav-btn-detail" id="pdFavBtn" onclick="toggleFavFromDetail()">ğŸ¤</button>
        <button class="btn btn-primary" style="flex:1;font-size:15px" onclick="addToCartFromDetail()">ğŸ›’ Sepete Ekle</button>
      </div>
      <!-- REVIEWS -->
      <div class="reviews-section">
        <div class="reviews-title">â­ DeÄŸerlendirmeler</div>
        <div id="reviewsList"></div>
        <div class="add-review-form">
          <div class="add-review-title">DeÄŸerlendirme Yaz</div>
          <div class="rating-input" id="ratingInput">
            <span class="rating-star" onclick="setRating(1)">â­</span>
            <span class="rating-star" onclick="setRating(2)">â­</span>
            <span class="rating-star" onclick="setRating(3)">â­</span>
            <span class="rating-star" onclick="setRating(4)">â­</span>
            <span class="rating-star" onclick="setRating(5)">â­</span>
          </div>
          <textarea class="review-textarea" id="reviewText" rows="3" placeholder="ÃœrÃ¼n hakkÄ±nda dÃ¼ÅŸÃ¼ncenizi paylaÅŸÄ±n..."></textarea>
          <button class="btn btn-primary" style="margin-top:10px" onclick="submitReview()">GÃ¶nder</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ORDER CONFIRM MODAL -->
<div class="modal-bg" id="orderModal">
  <div class="modal-box">
    <div class="modal-head">
      <span class="modal-head-title">âœ… SipariÅŸ AlÄ±ndÄ±!</span>
      <button class="modal-close" onclick="closeOrderModal()">âœ•</button>
    </div>
    <p style="font-size:14px;color:var(--text-muted);margin-bottom:14px">SipariÅŸiniz hazÄ±rlanÄ±yor, en kÄ±sa sÃ¼rede kapÄ±nÄ±za ulaÅŸtÄ±racaÄŸÄ±z! ğŸš€</p>
    <div id="orderConfirmBody"></div>
    <br>
    <button class="btn btn-primary" onclick="closeOrderModal()">Tamam, Anasayfaya DÃ¶n</button>
  </div>
</div>

<!-- DELETE CONFIRM MODAL -->
<div class="modal-bg" id="deleteConfirmModal">
  <div class="modal-box" style="max-width:380px;border-radius:20px;padding:28px 22px">
    <div style="text-align:center;margin-bottom:18px">
      <div style="font-size:48px;margin-bottom:10px">ğŸ—‘ï¸</div>
      <div style="font-size:18px;font-weight:900;margin-bottom:6px" id="deleteConfirmTitle">Silmek istediÄŸinize emin misiniz?</div>
      <div style="font-size:13px;color:var(--text-muted)" id="deleteConfirmDesc">Bu iÅŸlem geri alÄ±namaz.</div>
    </div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-outline" style="flex:1" onclick="closeDeleteConfirm()">HayÄ±r, VazgeÃ§</button>
      <button class="btn btn-danger" style="flex:1" id="deleteConfirmBtn" onclick="">Evet, Sil</button>
    </div>
  </div>
</div>


<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, browserLocalPersistence, browserSessionPersistence, setPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, doc, setDoc, getDoc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“± PWA INSTALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  _deferredPrompt = e;
  document.getElementById('pwaBanner').style.display = 'flex';
});
document.getElementById('pwaInstallBtn')?.addEventListener('click', async () => {
  if (_deferredPrompt) {
    _deferredPrompt.prompt();
    const { outcome } = await _deferredPrompt.userChoice;
    _deferredPrompt = null;
    document.getElementById('pwaBanner').style.display = 'none';
  }
});
window.addEventListener('appinstalled', () => {
  document.getElementById('pwaBanner').style.display = 'none';
  _deferredPrompt = null;
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”¥ FIREBASE CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey: "AIzaSyDjv1hwW1l4Ov9CBjHQUC6nhtb_Vl8-hq8",
  authDomain: "asmar-alisveris-merkezi.firebaseapp.com",
  projectId: "asmar-alisveris-merkezi",
  storageBucket: "asmar-alisveris-merkezi.firebasestorage.app",
  messagingSenderId: "474027686276",
  appId: "1:474027686276:web:fcda526fd5e852c62545d1",
  measurementId: "G-MCVD4PELQR"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const analytics = getAnalytics(app);

// â”€â”€ YÃ¼kleniyor ekranÄ±nda takÄ±lÄ± kalmasÄ±n (6 saniye timeout) â”€â”€
const _loadingTimeout = setTimeout(() => {
  const overlay = document.getElementById('loadingOverlay');
  if (overlay && overlay.style.display !== 'none') {
    overlay.style.display = 'none';
  }
}, 6000);

const ADMIN_EMAIL = "admin@asmar.com";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null;
let currentUserData = null;
let products = [];
let orders = [];
let cart = [];
let favorites = JSON.parse(localStorage.getItem('asmar_favs') || '[]');
let currentPayment = 'cash';
let productImgData = '';
let editingProdId = null;
let authMode = 'login';
let unsubProds = null;
let unsubOrders = null;
let unsubUserOrders = null;
let currentFilter = 'all';
let currentDetailProd = null;
let currentRating = 0;
let userOrders = [];

let settings = {
  iban: "TR00 0000 0000 0000 0000 0000 00",
  ibanName: "AS-MAR AlÄ±ÅŸveriÅŸ Merkezi",
  deliveryTime: "15-30",
  blocks: ["A","B","C","D","E","F"],
  flatMin: 1,
  flatMax: 50
};

const CATS = [
  { id:'Ä°Ã§ecek',      label:'Ä°Ã§ecek',      icon:'ğŸ¥¤', color:'#dbeafe' },
  { id:'SÃ¼tlÃ¼k',      label:'SÃ¼tlÃ¼k',      icon:'ğŸ¥›', color:'#f0fdf4' },
  { id:'Mutfak',      label:'Mutfak',      icon:'ğŸ³', color:'#fef3c7' },
  { id:'Temizlik',    label:'Temizlik',    icon:'ğŸ§´', color:'#d1fae5' },
  { id:'Manav',       label:'Manav',       icon:'ğŸ¥¦', color:'#ede9fe' },
  { id:'Kasap',       label:'Kasap',       icon:'ğŸ¥©', color:'#fee2e2' },
  { id:'DondurulmuÅŸ', label:'DondurulmuÅŸ', icon:'â„ï¸', color:'#e0f2fe' },
  { id:'AtÄ±ÅŸtÄ±rmalÄ±k',label:'AtÄ±ÅŸtÄ±rmalÄ±k',icon:'ğŸ«', color:'#fce7f3' },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type='') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show ' + type;
  clearTimeout(t._timer);
  t._timer = setTimeout(() => t.classList.remove('show'), 3000);
}

function showLoading(v) {
  document.getElementById('loadingOverlay').style.display = v ? 'flex' : 'none';
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function fmt(p) {
  return 'â‚º' + parseFloat(p || 0).toFixed(2).replace('.', ',');
}

function catIcon(catId) {
  return (CATS.find(c => c.id === catId) || {}).icon || 'ğŸ›’';
}

// â”€â”€ Remember Me Toggle â”€â”€
const rememberMeChk = document.getElementById('rememberMe');
const rememberHint = document.getElementById('rememberHint');
rememberMeChk.addEventListener('change', () => {
  if (rememberMeChk.checked) {
    rememberHint.textContent = 'âœ“ Bir daha giriÅŸ yapmanÄ±za gerek kalmaz';
    rememberHint.classList.remove('off');
  } else {
    rememberHint.textContent = 'TarayÄ±cÄ± kapÄ±nÄ±nca oturum sona erer';
    rememberHint.classList.add('off');
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
onAuthStateChanged(auth, async (user) => {
  clearTimeout(_loadingTimeout);
  showLoading(false);
  if (user) {
    currentUser = user;
    await loadSettings();
    if (user.email === ADMIN_EMAIL) {
      showScreen('adminScreen');
      initAdmin();
    } else {
      try {
        const snap = await getDoc(doc(db, 'users', user.uid));
        if (snap.exists()) currentUserData = snap.data();
      } catch(e) {}
      showScreen('mainApp');
      initMainApp();
    }
  } else {
    currentUser = null;
    currentUserData = null;
    cart = [];
    if (unsubProds) { unsubProds(); unsubProds = null; }
    if (unsubOrders) { unsubOrders(); unsubOrders = null; }
    showScreen('loginScreen');
    loadSettingsForLogin();
  }
});

async function loadSettingsForLogin() {
  try {
    const snap = await getDoc(doc(db, 'settings', 'main'));
    if (snap.exists()) settings = { ...settings, ...snap.data() };
  } catch(e) {}
  renderBlockSelects();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.handleAuth = async function() {
  const email = document.getElementById('authEmail').value.trim();
  const pass = document.getElementById('authPass').value;
  if (!email || !pass) { toast('E-posta ve ÅŸifre giriniz', 'error'); return; }
  showLoading(true);
  try {
    const remember = document.getElementById('rememberMe').checked;
    await setPersistence(auth, remember ? browserLocalPersistence : browserSessionPersistence);
    if (authMode === 'login') {
      await signInWithEmailAndPassword(auth, email, pass);
    } else {
      const name = document.getElementById('regName').value.trim();
      const phone = document.getElementById('regPhone').value.trim();
      const block = document.getElementById('regBlock').value;
      const flat = document.getElementById('regFlat').value;
      if (!name || !phone || !block || !flat) { showLoading(false); toast('TÃ¼m alanlarÄ± doldurunuz', 'error'); return; }
      const cred = await createUserWithEmailAndPassword(auth, email, pass);
      await updateProfile(cred.user, { displayName: name });
      await setDoc(doc(db, 'users', cred.user.uid), { name, email, phone, block, flat, createdAt: serverTimestamp() });
    }
  } catch(e) {
    showLoading(false);
    const M = {
      'auth/user-not-found':'KullanÄ±cÄ± bulunamadÄ±',
      'auth/wrong-password':'HatalÄ± ÅŸifre',
      'auth/invalid-credential':'HatalÄ± e-posta veya ÅŸifre',
      'auth/email-already-in-use':'Bu e-posta zaten kayÄ±tlÄ±',
      'auth/weak-password':'Åifre en az 6 karakter olmalÄ±',
      'auth/invalid-email':'GeÃ§ersiz e-posta adresi',
    };
    toast(M[e.code] || e.message, 'error');
  }
};

window.toggleMode = function() {
  authMode = authMode === 'login' ? 'register' : 'login';
  const isReg = authMode === 'register';
  document.getElementById('authTitle').textContent = isReg ? 'KayÄ±t Ol' : 'HoÅŸ Geldiniz';
  document.getElementById('authBtn').textContent = isReg ? 'KayÄ±t Ol' : 'GiriÅŸ Yap';
  document.getElementById('switchTxt').textContent = isReg ? 'Zaten hesabÄ±nÄ±z var mÄ±?' : 'HenÃ¼z hesabÄ±nÄ±z yok mu?';
  document.getElementById('switchLnk').textContent = isReg ? ' GiriÅŸ Yap' : ' KayÄ±t Ol';
  document.getElementById('regFields').style.display = isReg ? 'block' : 'none';
  document.getElementById('regAddrFields').style.display = isReg ? 'block' : 'none';
  document.getElementById('rememberMeRow').style.display = isReg ? 'none' : 'flex';
};

window.doLogout = async function() {
  if (unsubProds) { unsubProds(); unsubProds = null; }
  if (unsubOrders) { unsubOrders(); unsubOrders = null; }
  if (unsubUserOrders) { unsubUserOrders(); unsubUserOrders = null; }
  cart = [];
  await signOut(auth);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadSettings() {
  try {
    const snap = await getDoc(doc(db, 'settings', 'main'));
    if (snap.exists()) settings = { ...settings, ...snap.data() };
    else await setDoc(doc(db, 'settings', 'main'), settings);
  } catch(e) { console.log('Settings load failed, using defaults'); }
}

window.saveSettings = async function() {
  settings.iban = document.getElementById('setIban').value.trim();
  settings.ibanName = document.getElementById('setIbanName').value.trim();
  settings.deliveryTime = document.getElementById('setDelivery').value.trim();
  settings.flatMin = parseInt(document.getElementById('setFlatMin').value) || 1;
  settings.flatMax = parseInt(document.getElementById('setFlatMax').value) || 50;
  try {
    await setDoc(doc(db, 'settings', 'main'), settings);
    toast('Ayarlar kaydedildi âœ…', 'success');
  } catch(e) { toast('KayÄ±t hatasÄ±: ' + e.message, 'error'); }
};

function renderBlockSelects() {
  const blocks = settings.blocks || ['A','B','C','D','E','F'];
  ['regBlock','coBlock'].forEach(id => {
    const sel = document.getElementById(id);
    if (!sel) return;
    sel.innerHTML = '<option value="">SeÃ§iniz</option>' + blocks.map(b => `<option>${b} Blok</option>`).join('');
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APP INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initMainApp() {
  const ud = currentUserData || {};
  const name = currentUser.displayName || ud.name || 'KullanÄ±cÄ±';
  document.getElementById('userInfoDisplay').innerHTML = `<strong>${name}</strong>${ud.block ? ud.block + ' D:' + ud.flat : ''}`;
  document.getElementById('profileName').textContent = name;
  document.getElementById('profileEmail').textContent = currentUser.email;
  document.getElementById('profileAddr').textContent = ud.block ? `${ud.block} / Daire ${ud.flat}` : 'â€”';
  document.getElementById('profilePhone').textContent = ud.phone || 'â€”';
  document.getElementById('deliveryBadge').textContent = settings.deliveryTime || '15-30';

  renderBlockSelects();
  if (ud.block) document.getElementById('coBlock').value = ud.block;
  if (ud.flat) document.getElementById('coFlat').value = ud.flat;

  renderHomeCats();
  updateCartBadge();
  startUserOrdersListener();

  unsubProds = onSnapshot(collection(db, 'products'), snap => {
    products = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderWeekly();
  });

  switchPage('home');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAGE NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.switchPage = function(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const pg = document.getElementById('page-' + page);
  if (pg) pg.classList.add('active');
  const nav = document.getElementById('nav-' + page);
  if (nav) nav.classList.add('active');

  if (page === 'cart') renderCart();
  if (page === 'checkout') renderCheckout();
  if (page === 'categories') {
    document.getElementById('catFullGrid').style.display = 'grid';
    document.getElementById('catProdView').style.display = 'none';
    renderCatGrid();
  }
  if (page === 'favorites') renderFavorites();
  if (page === 'orders-history') renderOrderHistory();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHomeCats() {
  document.getElementById('homeCats').innerHTML = CATS.map(c => `
    <div class="cat-chip" onclick="showCatProds('${c.id}')">
      <div class="cat-chip-icon" style="background:${c.color}">${c.icon}</div>
      <span class="cat-chip-label">${c.label}</span>
    </div>
  `).join('');
}

function renderWeekly() {
  const weekly = products.filter(p => p.weekly);
  const grid = document.getElementById('weeklyGrid');
  const sec = document.getElementById('weeklySec');
  if (!weekly.length) {
    sec.style.display = 'none';
  } else {
    sec.style.display = 'block';
    grid.innerHTML = weekly.map(p => prodCardHTML(p)).join('');
  }
  // Always render all products too
  renderAllProducts();
}

const PRODUCTS_PER_PAGE = 10;
let currentPage = 1;
let filteredProducts = [];

function renderAllProducts() {
  applyFilters();
}

window.filterSearch = function() {
  currentPage = 1;
  applyFilters();
};

function prodCardHTML(p) {
  const cat = CATS.find(c => c.id === p.category);
  const imgContent = p.image
    ? `<img src="${p.image}" alt="${p.name}" onerror="this.parentElement.innerHTML='${cat ? cat.icon : 'ğŸ›’'}'">` 
    : (cat ? cat.icon : 'ğŸ›’');
  const isFav = favorites.includes(p.id);
  return `
    <div class="product-card">
      <div class="product-img" onclick="openProdDetail('${p.id}')" style="cursor:pointer">
        ${imgContent}
        <button class="fav-btn" onclick="event.stopPropagation();toggleFav('${p.id}',this)" title="Favorilere ekle">${isFav ? 'â¤ï¸' : 'ğŸ¤'}</button>
      </div>
      <div class="product-body">
        <div class="product-name" onclick="openProdDetail('${p.id}')" style="cursor:pointer">${p.name}</div>
        <div class="product-cat-label">${p.category}</div>
        <div class="product-prices">
          <span class="price-now">${fmt(p.price)}</span>
          ${p.oldPrice ? `<span class="price-was">${fmt(p.oldPrice)}</span>` : ''}
          ${p.weekly ? '<span class="sale-tag">Ä°NDÄ°RÄ°M</span>' : ''}
        </div>
        <button class="add-to-cart" onclick="addToCart('${p.id}')">ğŸ›’ Sepete Ekle</button>
      </div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CATEGORIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCatGrid() {
  document.getElementById('catFullGrid').innerHTML = CATS.map(c => {
    const cnt = products.filter(p => p.category === c.id).length;
    return `
      <div class="cat-full-card" onclick="showCatProds('${c.id}')">
        <div class="cat-full-icon">${c.icon}</div>
        <div class="cat-full-name">${c.label}</div>
        <div class="cat-full-count">${cnt} Ã¼rÃ¼n</div>
      </div>
    `;
  }).join('');
}

window.showCatProds = function(catId) {
  const cat = CATS.find(c => c.id === catId);
  const filtered = products.filter(p => p.category === catId);
  document.getElementById('catViewTitle').textContent = cat ? `${cat.icon} ${cat.label}` : catId;
  document.getElementById('catProdGrid').innerHTML = filtered.length
    ? filtered.map(p => prodCardHTML(p)).join('')
    : '<p style="color:var(--text-muted);grid-column:span 2;padding:20px 0">Bu kategoride Ã¼rÃ¼n yok.</p>';
  // Ã–nce sayfayÄ± aÃ§, sonra gÃ¶rÃ¼nÃ¼mleri ayarla
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-categories').classList.add('active');
  document.getElementById('nav-categories').classList.add('active');
  document.getElementById('catFullGrid').style.display = 'none';
  document.getElementById('catProdView').style.display = 'block';
};

window.closeCatView = function() {
  document.getElementById('catProdView').style.display = 'none';
  document.getElementById('catFullGrid').style.display = 'grid';
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addToCart = function(prodId) {
  const p = products.find(x => x.id === prodId);
  if (!p) return;
  const ex = cart.find(i => i.id === prodId);
  if (ex) ex.qty++;
  else cart.push({ ...p, qty: 1 });
  updateCartBadge();
  toast(`${p.name} sepete eklendi âœ…`, 'success');
};

function updateCartBadge() {
  document.getElementById('cartBadge').textContent = cart.reduce((s,i) => s + i.qty, 0);
}

window.renderCart = function() {
  const empty = document.getElementById('cartEmpty');
  const full = document.getElementById('cartFull');
  if (!cart.length) { empty.style.display='block'; full.style.display='none'; return; }
  empty.style.display = 'none'; full.style.display = 'block';

  document.getElementById('cartList').innerHTML = cart.map(item => {
    const cat = CATS.find(c => c.id === item.category);
    const imgHTML = item.image
      ? `<img src="${item.image}" alt="" onerror="this.parentElement.innerHTML='${cat ? cat.icon : 'ğŸ›’'}'">`
      : (cat ? cat.icon : 'ğŸ›’');
    return `
      <div class="cart-item">
        <div class="cart-img">${imgHTML}</div>
        <div class="cart-info">
          <div class="cart-name">${item.name}</div>
          <div class="cart-price">${fmt(item.price * item.qty)}</div>
          <div class="qty-row">
            <button class="qty-btn" onclick="changeQty('${item.id}',-1)">âˆ’</button>
            <span class="qty-val">${item.qty}</span>
            <button class="qty-btn" onclick="changeQty('${item.id}',1)">+</button>
          </div>
        </div>
        <button class="del-btn" onclick="removeCart('${item.id}')">ğŸ—‘ï¸</button>
      </div>
    `;
  }).join('');

  const sub = cart.reduce((s,i) => s + i.price*i.qty, 0);
  document.getElementById('cartTotalBox').innerHTML = `
    <div class="total-row"><span>Ara Toplam</span><span>${fmt(sub)}</span></div>
    <div class="total-row free"><span>âœ… Teslimat</span><span>ÃœCRETSÄ°Z</span></div>
    <div class="total-row"><span>Toplam</span><span>${fmt(sub)}</span></div>
    <br><button class="btn btn-primary" onclick="switchPage('checkout')">SipariÅŸi Tamamla â†’</button>
  `;
};

window.changeQty = function(id, d) {
  const item = cart.find(i => i.id === id);
  if (!item) return;
  item.qty += d;
  if (item.qty <= 0) cart = cart.filter(i => i.id !== id);
  updateCartBadge();
  renderCart();
};

window.removeCart = function(id) {
  cart = cart.filter(i => i.id !== id);
  updateCartBadge();
  renderCart();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHECKOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.selPay = function(method) {
  currentPayment = method;
  document.querySelectorAll('.pay-opt').forEach(o => o.classList.remove('selected'));
  document.getElementById('pay-' + method).classList.add('selected');
  const ibanBox = document.getElementById('ibanInfoBox');
  ibanBox.style.display = method === 'iban' ? 'block' : 'none';
  ibanBox.innerHTML = `<strong>IBAN Bilgisi</strong>${settings.iban || 'TR00...'}<br><span style="color:var(--text-muted)">AlÄ±cÄ±: ${settings.ibanName || 'AS-MAR'}<br>AÃ§Ä±klama: Ad Soyad + Daire No</span>`;
};

window.renderCheckout = function() {
  const sub = cart.reduce((s,i) => s + i.price*i.qty, 0);
  document.getElementById('coTotal').textContent = fmt(sub);
  document.getElementById('coDeliveryTime').textContent = settings.deliveryTime || '15-30';
  renderBlockSelects();
  if (currentUserData?.block) document.getElementById('coBlock').value = currentUserData.block;
  if (currentUserData?.flat) document.getElementById('coFlat').value = currentUserData.flat;
  document.getElementById('coOrderSummary').innerHTML = cart.map(i =>
    `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:14px">
      <span>${i.name} Ã— ${i.qty}</span><span style="font-weight:700">${fmt(i.price*i.qty)}</span>
    </div>`
  ).join('') + `<div style="display:flex;justify-content:space-between;padding:11px 0;font-size:17px;font-weight:900;color:var(--primary)"><span>Toplam</span><span>${fmt(sub)}</span></div>`;
};

window.placeOrder = async function() {
  const block = document.getElementById('coBlock').value;
  const flat = document.getElementById('coFlat').value;
  if (!block || !flat) { toast('Blok ve daire numarasÄ± giriniz', 'error'); return; }
  if (!cart.length) { toast('Sepetiniz boÅŸ', 'error'); return; }
  showLoading(true);
  const sub = cart.reduce((s,i) => s + i.price*i.qty, 0);
  try {
    const ref = await addDoc(collection(db, 'orders'), {
      userId: currentUser.uid,
      userName: currentUser.displayName || currentUserData?.name || 'KullanÄ±cÄ±',
      userEmail: currentUser.email,
      address: `${block} - Daire ${flat}`,
      note: document.getElementById('coNote').value,
      items: cart.map(i => ({ name: i.name, qty: i.qty, price: i.price })),
      total: sub,
      payment: currentPayment === 'cash' ? 'KapÄ±da Ã–deme' : 'IBAN Havale',
      status: 'new',
      createdAt: serverTimestamp()
    });
    showLoading(false);
    document.getElementById('orderConfirmBody').innerHTML = `
      <div class="confirm-row"><span>SipariÅŸ No</span><span style="font-size:11px">#${ref.id.slice(0,10).toUpperCase()}</span></div>
      <div class="confirm-row"><span>Adres</span><span>${block} - Daire ${flat}</span></div>
      <div class="confirm-row"><span>Ã–deme</span><span>${currentPayment === 'cash' ? 'KapÄ±da Ã–deme' : 'IBAN Havale'}</span></div>
      <div class="confirm-row"><span>Toplam</span><span>${fmt(sub)}</span></div>
    `;
    document.getElementById('orderModal').classList.add('open');
    cart = [];
    updateCartBadge();
  } catch(e) {
    showLoading(false);
    toast('Hata: ' + e.message, 'error');
  }
};

window.closeOrderModal = function() {
  document.getElementById('orderModal').classList.remove('open');
  switchPage('home');
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTER & SORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentSortFilter = 'default';

window.setFilter = function(filter, el) {
  currentFilter = filter;
  currentPage = 1;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  applyFilters();
};

window.openFilterModal = function() {
  document.getElementById('filterModalBg').classList.add('open');
};
window.closeFilterModal = function(e) {
  if (!e || e.target === document.getElementById('filterModalBg') || !e.target) {
    document.getElementById('filterModalBg').classList.remove('open');
  }
};
window.setSortFilter = function(sort, el) {
  currentSortFilter = sort;
  document.querySelectorAll('.fm-sort-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
};
window.resetFilters = function() {
  document.getElementById('priceMin').value = '';
  document.getElementById('priceMax').value = '';
  currentSortFilter = 'default';
  document.querySelectorAll('.fm-sort-btn').forEach((b,i) => b.classList.toggle('active', i===0));
};
window.applyFilterModal = function() {
  currentPage = 1;
  applyFilters();
  closeFilterModal();
};

window.applyFilters = function() {
  const q = document.getElementById('homeSearch').value.toLowerCase();
  const minP = parseFloat(document.getElementById('priceMin').value) || 0;
  const maxP = parseFloat(document.getElementById('priceMax').value) || Infinity;

  filteredProducts = products.filter(p => {
    const matchQ = !q || p.name.toLowerCase().includes(q) || p.category.toLowerCase().includes(q);
    const matchFilter = currentFilter === 'all' ? true
      : currentFilter === 'weekly' ? p.weekly
      : p.category === currentFilter;
    const matchPrice = p.price >= minP && (maxP === Infinity || p.price <= maxP);
    return matchQ && matchFilter && matchPrice;
  });

  if (currentSortFilter === 'price_asc') filteredProducts.sort((a,b) => a.price - b.price);
  else if (currentSortFilter === 'price_desc') filteredProducts.sort((a,b) => b.price - a.price);
  else if (currentSortFilter === 'name_asc') filteredProducts.sort((a,b) => a.name.localeCompare(b.name, 'tr'));

  const title = document.getElementById('allProdTitle');
  const countEl = document.getElementById('allProdCount');
  if (q) title.textContent = `Arama: "${document.getElementById('homeSearch').value}"`;
  else if (currentFilter === 'weekly') title.textContent = 'â­ Ä°ndirimli ÃœrÃ¼nler';
  else if (currentFilter !== 'all') title.textContent = currentFilter;
  else title.textContent = 'TÃ¼m ÃœrÃ¼nler';
  countEl.textContent = `(${filteredProducts.length})`;

  renderPage(currentPage);
};

function renderPage(page) {
  currentPage = page;
  const totalPages = Math.ceil(filteredProducts.length / PRODUCTS_PER_PAGE);
  const start = (page - 1) * PRODUCTS_PER_PAGE;
  const pageProds = filteredProducts.slice(start, start + PRODUCTS_PER_PAGE);
  const grid = document.getElementById('allProdGrid');
  grid.innerHTML = filteredProducts.length
    ? pageProds.map(p => prodCardHTML(p)).join('')
    : '<p style="color:var(--text-muted);grid-column:span 2;padding:20px 0;text-align:center">ÃœrÃ¼n bulunamadÄ±.</p>';

  const prow = document.getElementById('paginateRow');
  if (totalPages <= 1) { prow.style.display = 'none'; return; }
  prow.style.display = 'flex';
  let html = `<button class="page-btn" onclick="renderPage(${page-1})" ${page===1?'disabled':''}>â€¹</button>`;
  for (let i = 1; i <= totalPages; i++) {
    if (totalPages > 7 && i > 2 && i < totalPages - 1 && Math.abs(i - page) > 1) {
      if (i === 3 || i === totalPages - 2) html += `<span style="color:var(--text-muted);padding:0 4px">â€¦</span>`;
      continue;
    }
    html += `<button class="page-btn ${i===page?'active':''}" onclick="renderPage(${i})">${i}</button>`;
  }
  html += `<button class="page-btn" onclick="renderPage(${page+1})" ${page===totalPages?'disabled':''}>â€º</button>`;
  prow.innerHTML = html;
}

window.clearSearch = function() {
  document.getElementById('homeSearch').value = '';
  currentPage = 1;
  applyFilters();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FAVORITES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveFavs() {
  localStorage.setItem('asmar_favs', JSON.stringify(favorites));
}

window.toggleFav = function(prodId, btn) {
  const idx = favorites.indexOf(prodId);
  if (idx === -1) {
    favorites.push(prodId);
    if (btn) btn.textContent = 'â¤ï¸';
    toast('Favorilere eklendi â¤ï¸', 'success');
  } else {
    favorites.splice(idx, 1);
    if (btn) btn.textContent = 'ğŸ¤';
    toast('Favorilerden Ã§Ä±karÄ±ldÄ±');
  }
  saveFavs();
};

window.renderFavorites = function() {
  const favProds = products.filter(p => favorites.includes(p.id));
  const grid = document.getElementById('favGrid');
  const empty = document.getElementById('favEmpty');
  if (!favProds.length) {
    grid.innerHTML = '';
    empty.style.display = 'block';
  } else {
    empty.style.display = 'none';
    grid.innerHTML = favProds.map(p => prodCardHTML(p)).join('');
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRODUCT DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.openProdDetail = async function(prodId) {
  const p = products.find(x => x.id === prodId);
  if (!p) return;
  currentDetailProd = p;
  currentRating = 0;
  const cat = CATS.find(c => c.id === p.category);

  // Image
  const imgEl = document.getElementById('pdImg');
  imgEl.innerHTML = `<button class="prod-detail-close" onclick="closeProdDetail()">âœ•</button>`;
  if (p.image) {
    const img = document.createElement('img');
    img.src = p.image;
    img.alt = p.name;
    img.onerror = () => { imgEl.innerHTML = `<button class="prod-detail-close" onclick="closeProdDetail()">âœ•</button>${cat ? cat.icon : 'ğŸ›’'}`; };
    imgEl.appendChild(img);
  } else {
    imgEl.innerHTML += cat ? cat.icon : 'ğŸ›’';
  }

  document.getElementById('pdCat').textContent = p.category;
  document.getElementById('pdName').textContent = p.name;
  document.getElementById('pdPrice').textContent = fmt(p.price);
  document.getElementById('pdOld').textContent = p.oldPrice ? fmt(p.oldPrice) : '';
  document.getElementById('pdDesc').textContent = p.description || 'Bu Ã¼rÃ¼n iÃ§in aÃ§Ä±klama bulunmamaktadÄ±r.';

  // Fav button
  const isFav = favorites.includes(p.id);
  document.getElementById('pdFavBtn').textContent = isFav ? 'â¤ï¸' : 'ğŸ¤';
  document.getElementById('pdFavBtn').classList.toggle('active', isFav);

  // Reset rating stars
  document.getElementById('reviewText').value = '';
  setRating(0);

  // Load reviews
  await loadReviews(prodId);

  document.getElementById('prodDetailModal').classList.add('open');
  document.body.style.overflow = 'hidden';
};

window.closeProdDetail = function() {
  document.getElementById('prodDetailModal').classList.remove('open');
  document.body.style.overflow = '';
  currentDetailProd = null;
};

window.addToCartFromDetail = function() {
  if (!currentDetailProd) return;
  addToCart(currentDetailProd.id);
};

window.toggleFavFromDetail = function() {
  if (!currentDetailProd) return;
  const btn = document.getElementById('pdFavBtn');
  toggleFav(currentDetailProd.id, null);
  const isFav = favorites.includes(currentDetailProd.id);
  btn.textContent = isFav ? 'â¤ï¸' : 'ğŸ¤';
  btn.classList.toggle('active', isFav);
  // update cards in background
  renderWeekly();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REVIEWS & RATINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.setRating = function(n) {
  currentRating = n;
  document.querySelectorAll('.rating-star').forEach((s, i) => {
    s.classList.toggle('active', i < n);
  });
};

async function loadReviews(prodId) {
  try {
    const snap = await getDocs(query(collection(db, 'reviews'), where('prodId','==',prodId), orderBy('createdAt','desc')));
    const reviews = snap.docs.map(d => d.data());
    renderReviews(reviews);
  } catch(e) {
    document.getElementById('reviewsList').innerHTML = '<p style="color:var(--text-muted);font-size:13px">Yorumlar yÃ¼klenemedi.</p>';
  }
}

function renderReviews(reviews) {
  const list = document.getElementById('reviewsList');
  const summary = document.getElementById('pdRatingSummary');
  if (!reviews.length) {
    list.innerHTML = '<p style="color:var(--text-muted);font-size:13px;margin-bottom:8px">HenÃ¼z deÄŸerlendirme yok. Ä°lk sen yaz!</p>';
    summary.innerHTML = '';
    return;
  }
  const avg = reviews.reduce((s,r) => s + (r.rating||0), 0) / reviews.length;
  summary.innerHTML = `<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
    <span style="font-size:22px;font-weight:900;color:var(--primary)">${avg.toFixed(1)}</span>
    <span style="font-size:18px">${'â­'.repeat(Math.round(avg))}</span>
    <span style="font-size:13px;color:var(--text-muted)">(${reviews.length} deÄŸerlendirme)</span>
  </div>`;
  list.innerHTML = reviews.map(r => `
    <div class="review-card">
      <div class="review-header">
        <span class="review-author">${r.userName || 'KullanÄ±cÄ±'}</span>
        <span class="review-date">${r.createdAt?.toDate ? r.createdAt.toDate().toLocaleDateString('tr-TR') : ''}</span>
      </div>
      <div class="review-stars">${'â­'.repeat(r.rating || 0)}</div>
      <div class="review-text">${r.text || ''}</div>
    </div>
  `).join('');
}

window.submitReview = async function() {
  if (!currentDetailProd) return;
  if (!currentRating) { toast('LÃ¼tfen yÄ±ldÄ±z seÃ§in', 'error'); return; }
  const text = document.getElementById('reviewText').value.trim();
  if (!text) { toast('LÃ¼tfen yorum yazÄ±n', 'error'); return; }
  showLoading(true);
  try {
    await addDoc(collection(db, 'reviews'), {
      prodId: currentDetailProd.id,
      userId: currentUser.uid,
      userName: currentUser.displayName || currentUserData?.name || 'KullanÄ±cÄ±',
      rating: currentRating,
      text,
      createdAt: serverTimestamp()
    });
    showLoading(false);
    toast('DeÄŸerlendirmeniz eklendi âœ…', 'success');
    document.getElementById('reviewText').value = '';
    setRating(0);
    await loadReviews(currentDetailProd.id);
  } catch(e) {
    showLoading(false);
    toast('Hata: ' + e.message, 'error');
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ORDER HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startUserOrdersListener() {
  if (!currentUser) return;
  if (unsubUserOrders) { unsubUserOrders(); unsubUserOrders = null; }
  try {
    const q = query(
      collection(db, 'orders'),
      where('userId', '==', currentUser.uid),
      orderBy('createdAt', 'desc')
    );
    unsubUserOrders = onSnapshot(q, snap => {
      userOrders = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      // Re-render if the page is currently visible
      const histPage = document.getElementById('page-orders-history');
      if (histPage && histPage.classList.contains('active')) {
        renderOrderHistory();
      }
    }, err => { console.log('Order history error:', err.message); });
  } catch(e) { console.log('Order history setup error:', e.message); }
}

window.renderOrderHistory = function() {
  const list = document.getElementById('orderHistList');
  const empty = document.getElementById('orderHistEmpty');
  if (!userOrders.length) {
    list.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';
  const statusMap = { new: 'ğŸŸ¡ HazÄ±rlanÄ±yor', done: 'âœ… Teslim Edildi', cancelled: 'âŒ Ä°ptal' };
  list.innerHTML = userOrders.map(o => `
    <div class="order-hist-card">
      <div class="order-hist-head">
        <span class="order-hist-id">#${o.id.slice(0,8).toUpperCase()}</span>
        <span class="status-badge ${o.status === 'new' ? 's-new' : o.status === 'done' ? 's-done' : 's-cancelled'}">${statusMap[o.status] || o.status}</span>
      </div>
      <div class="order-hist-items">${(o.items||[]).map(i => `${i.name} Ã—${i.qty}`).join(', ')}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
        <span class="order-hist-date">ğŸ“… ${o.createdAt?.toDate ? o.createdAt.toDate().toLocaleDateString('tr-TR') : 'â€”'} Â· ğŸ“ ${o.address||''}</span>
        <span class="order-hist-total">${fmt(o.total)}</span>
      </div>
    </div>
  `).join('');
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FAQ TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.toggleFaq = function(el) {
  el.classList.toggle('open');
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EDIT PROFILE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.openEditProfile = function() {
  const ud = currentUserData || {};
  document.getElementById('epName').value = currentUser.displayName || ud.name || '';
  document.getElementById('epPhone').value = ud.phone || '';
  // populate block select
  const blocks = settings.blocks || ['A','B','C','D','E','F'];
  const epBlock = document.getElementById('epBlock');
  epBlock.innerHTML = '<option value="">SeÃ§iniz</option>' + blocks.map(b => `<option ${ud.block === b+' Blok' || ud.block === b ? 'selected' : ''}>${b} Blok</option>`).join('');
  document.getElementById('epFlat').value = ud.flat || '';
  document.getElementById('editProfileModal').classList.add('open');
};

window.closeEditProfile = function() {
  document.getElementById('editProfileModal').classList.remove('open');
};

window.saveProfile = async function() {
  const name = document.getElementById('epName').value.trim();
  const phone = document.getElementById('epPhone').value.trim();
  const block = document.getElementById('epBlock').value;
  const flat = document.getElementById('epFlat').value;
  if (!name) { toast('Ad soyad boÅŸ olamaz', 'error'); return; }
  showLoading(true);
  try {
    await updateProfile(currentUser, { displayName: name });
    const newData = { name, phone, block, flat };
    await setDoc(doc(db, 'users', currentUser.uid), { ...currentUserData, ...newData }, { merge: true });
    currentUserData = { ...currentUserData, ...newData };
    // update UI
    document.getElementById('profileName').textContent = name;
    document.getElementById('profileAddr').textContent = block ? `${block} / Daire ${flat}` : 'â€”';
    document.getElementById('profilePhone').textContent = phone || 'â€”';
    document.getElementById('userInfoDisplay').innerHTML = `<strong>${name}</strong>${block ? ' ' + block + ' D:' + flat : ''}`;
    showLoading(false);
    toast('Bilgiler gÃ¼ncellendi âœ…', 'success');
    closeEditProfile();
  } catch(e) {
    showLoading(false);
    toast('Hata: ' + e.message, 'error');
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initAdmin() {
  renderAdmSettings();
  unsubProds = onSnapshot(collection(db, 'products'), snap => {
    products = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderAdmDash();
    renderAdmProducts();
  });
  unsubOrders = onSnapshot(query(collection(db, 'orders'), orderBy('createdAt', 'desc')), snap => {
    orders = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderAdmDash();
    renderAdmOrders();
  });
}

window.switchAdm = function(page, btn) {
  document.querySelectorAll('.adm-page').forEach(p => p.classList.remove('active'));
  document.getElementById('adm-' + page).classList.add('active');
  document.querySelectorAll('.adm-nav-btn').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');
  if (page === 'addProduct') clearProdForm();
  if (page === 'settings') renderAdmSettings();
};

function renderAdmDash() {
  document.getElementById('stProducts').textContent = products.length;
  document.getElementById('stNewOrders').textContent = orders.filter(o => o.status === 'new').length;
  document.getElementById('stTotalOrders').textContent = orders.length;
  document.getElementById('dashProdList').innerHTML = products.slice(0,5).map(p => prodAdmRowHTML(p)).join('') || '<p style="color:var(--text-muted)">ÃœrÃ¼n yok.</p>';
}

function prodAdmRowHTML(p) {
  const cat = CATS.find(c => c.id === p.category);
  const imgHTML = p.image ? `<img src="${p.image}" alt="" onerror="this.parentElement.innerHTML='${catIcon(p.category)}'">` : catIcon(p.category);
  return `
    <div class="prod-row">
      <div class="prod-row-img">${imgHTML}</div>
      <div class="prod-row-info">
        <div class="prod-row-name">${p.name} ${p.weekly ? 'â­' : ''}</div>
        <div class="prod-row-cat">${p.category}</div>
        <div class="prod-row-prices">
          <span class="prod-price">${fmt(p.price)}</span>
          ${p.oldPrice ? `<span class="prod-old">${fmt(p.oldPrice)}</span>` : ''}
        </div>
      </div>
      <div class="prod-row-acts">
        <button class="btn btn-sm btn-outline" onclick="editProd('${p.id}')">âœï¸</button>
        <button class="btn btn-sm btn-danger" onclick="deleteProd('${p.id}')">ğŸ—‘ï¸</button>
      </div>
    </div>
  `;
}

window.renderAdmProducts = function() {
  const q = (document.getElementById('admSearch')?.value || '').toLowerCase();
  const f = products.filter(p => p.name.toLowerCase().includes(q) || p.category.toLowerCase().includes(q));
  document.getElementById('admProductList').innerHTML = `
    <div class="adm-card">
      <div class="adm-card-title">ÃœrÃ¼nler (${f.length})</div>
      ${f.map(p => prodAdmRowHTML(p)).join('') || '<p style="color:var(--text-muted)">ÃœrÃ¼n bulunamadÄ±.</p>'}
    </div>
  `;
};

window.renderAdmOrders = function() {
  const el = document.getElementById('admOrderList');
  if (!orders.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“¦</div><div class="empty-title">HenÃ¼z sipariÅŸ yok</div></div>';
    return;
  }
  el.innerHTML = `
    <div class="adm-card" style="margin-bottom:14px">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
        <label style="display:flex;align-items:center;gap:8px;font-size:14px;font-weight:700;cursor:pointer">
          <input type="checkbox" id="selectAllOrders" onchange="toggleSelectAllOrders(this)" style="width:18px;height:18px;cursor:pointer">
          TÃ¼mÃ¼nÃ¼ SeÃ§
        </label>
        <button class="btn btn-danger btn-sm" id="bulkDeleteBtn" onclick="bulkDeleteOrders()" style="display:none">ğŸ—‘ï¸ SeÃ§ilenleri Sil</button>
      </div>
    </div>
  ` + orders.map(o => {
    const dt = o.createdAt?.toDate ? o.createdAt.toDate().toLocaleString('tr-TR') : 'â€”';
    const sc = o.status==='new' ? 's-new' : o.status==='done' ? 's-done' : 's-cancelled';
    const sl = o.status==='new' ? 'ğŸ†• Yeni' : o.status==='done' ? 'âœ… Teslim Edildi' : 'âŒ Ä°ptal';
    return `
      <div class="order-card" id="order-card-${o.id}">
        <div class="order-head">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="checkbox" class="order-select-cb" data-id="${o.id}" onchange="updateBulkDeleteBtn()" style="width:16px;height:16px;cursor:pointer">
            <span class="order-id">#${o.id.slice(0,10).toUpperCase()}</span>
          </label>
          <span class="status-badge ${sc}">${sl}</span>
        </div>
        <div class="order-detail">ğŸ‘¤ ${o.userName} â€” ${o.userEmail}</div>
        <div class="order-detail">ğŸ“ ${o.address}</div>
        <div class="order-detail">ğŸ’³ ${o.payment}</div>
        <div class="order-detail">ğŸ• ${dt}</div>
        ${o.note ? `<div class="order-detail">ğŸ“ ${o.note}</div>` : ''}
        <div class="order-items-list">${o.items?.map(i => `<div class="order-item-row"><span class="order-item-name">${i.name}</span><span class="order-item-qty">Ã— ${i.qty}</span><span class="order-item-price">${fmt(i.price * i.qty)}</span></div>`).join('') || ''}</div>
        <div class="order-total-text">${fmt(o.total)}</div>
        <div class="order-actions">
          <button class="btn btn-sm btn-success" onclick="setOrderStatus('${o.id}','done')">âœ… Teslim Et</button>
          <button class="btn btn-sm btn-danger" onclick="setOrderStatus('${o.id}','cancelled')">âŒ Ä°ptal</button>
          <button class="btn btn-sm" style="background:#f3f4f6;color:#374151;border:1.5px solid #e5e7eb" onclick="confirmDeleteOrder('${o.id}')">ğŸ—‘ï¸ Sil</button>
        </div>
      </div>
    `;
  }).join('');
};

window.setOrderStatus = async function(id, status) {
  try {
    await updateDoc(doc(db, 'orders', id), { status });
    toast('SipariÅŸ gÃ¼ncellendi âœ…', 'success');
  } catch(e) { toast('Hata: ' + e.message, 'error'); }
};

// â”€â”€ Order Delete â”€â”€
window.confirmDeleteOrder = function(id) {
  document.getElementById('deleteConfirmTitle').textContent = 'SipariÅŸi silmek istediÄŸinize emin misiniz?';
  document.getElementById('deleteConfirmDesc').textContent = 'Bu iÅŸlem geri alÄ±namaz.';
  document.getElementById('deleteConfirmBtn').onclick = async () => {
    closeDeleteConfirm();
    try {
      await deleteDoc(doc(db, 'orders', id));
      toast('SipariÅŸ silindi ğŸ—‘ï¸', 'success');
    } catch(e) { toast('Hata: ' + e.message, 'error'); }
  };
  document.getElementById('deleteConfirmModal').classList.add('open');
};

window.closeDeleteConfirm = function() {
  document.getElementById('deleteConfirmModal').classList.remove('open');
};

window.toggleSelectAllOrders = function(cb) {
  document.querySelectorAll('.order-select-cb').forEach(c => c.checked = cb.checked);
  updateBulkDeleteBtn();
};

window.updateBulkDeleteBtn = function() {
  const checked = document.querySelectorAll('.order-select-cb:checked');
  const btn = document.getElementById('bulkDeleteBtn');
  if (btn) {
    btn.style.display = checked.length > 0 ? 'flex' : 'none';
    btn.textContent = `ğŸ—‘ï¸ SeÃ§ilenleri Sil (${checked.length})`;
  }
  // update "select all" checkbox state
  const all = document.querySelectorAll('.order-select-cb');
  const selAll = document.getElementById('selectAllOrders');
  if (selAll && all.length) selAll.checked = checked.length === all.length;
};

window.bulkDeleteOrders = function() {
  const checked = document.querySelectorAll('.order-select-cb:checked');
  if (!checked.length) return;
  const ids = [...checked].map(c => c.dataset.id);
  document.getElementById('deleteConfirmTitle').textContent = `${ids.length} sipariÅŸi silmek istediÄŸinize emin misiniz?`;
  document.getElementById('deleteConfirmDesc').textContent = 'SeÃ§ilen tÃ¼m sipariÅŸler kalÄ±cÄ± olarak silinecek. Bu iÅŸlem geri alÄ±namaz.';
  document.getElementById('deleteConfirmBtn').onclick = async () => {
    closeDeleteConfirm();
    showLoading(true);
    try {
      await Promise.all(ids.map(id => deleteDoc(doc(db, 'orders', id))));
      showLoading(false);
      toast(`${ids.length} sipariÅŸ silindi ğŸ—‘ï¸`, 'success');
    } catch(e) {
      showLoading(false);
      toast('Hata: ' + e.message, 'error');
    }
  };
  document.getElementById('deleteConfirmModal').classList.add('open');
};

// â”€â”€ Product CRUD â”€â”€
window.editProd = function(id) {
  const p = products.find(x => x.id === id);
  if (!p) return;
  editingProdId = id;
  document.getElementById('addProdTitle').textContent = 'âœï¸ ÃœrÃ¼n DÃ¼zenle';
  document.getElementById('pName').value = p.name;
  document.getElementById('pCat').value = p.category;
  document.getElementById('pPrice').value = p.price;
  document.getElementById('pOldPrice').value = p.oldPrice || '';
  document.getElementById('pDesc').value = p.description || '';
  document.getElementById('pWeekly').checked = p.weekly || false;
  document.getElementById('pImgUrl').value = p.image || '';
  productImgData = p.image || '';
  document.getElementById('imgPrev').innerHTML = p.image ? `<img src="${p.image}" alt="">` : 'ğŸ–¼ï¸';
  document.querySelectorAll('.adm-page').forEach(pg => pg.classList.remove('active'));
  document.getElementById('adm-addProduct').classList.add('active');
  document.querySelectorAll('.adm-nav-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.adm-nav-btn')[2].classList.add('active');
};

window.deleteProd = async function(id) {
  if (!confirm('Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinize emin misiniz?')) return;
  try {
    await deleteDoc(doc(db, 'products', id));
    toast('ÃœrÃ¼n silindi ğŸ—‘ï¸');
  } catch(e) { toast('Hata: ' + e.message, 'error'); }
};

window.clearProdForm = function() {
  editingProdId = null;
  productImgData = '';
  document.getElementById('addProdTitle').textContent = 'â• Yeni ÃœrÃ¼n Ekle';
  ['pName','pPrice','pOldPrice','pDesc','pImgUrl'].forEach(id => { const el = document.getElementById(id); if(el) el.value = ''; });
  document.getElementById('pCat').value = 'Ä°Ã§ecek';
  document.getElementById('pWeekly').checked = false;
  document.getElementById('imgPrev').innerHTML = 'ğŸ–¼ï¸';
};

window.saveProd = async function() {
  const name = document.getElementById('pName').value.trim();
  const category = document.getElementById('pCat').value;
  const price = parseFloat(document.getElementById('pPrice').value);
  const oldPrice = parseFloat(document.getElementById('pOldPrice').value) || null;
  const description = document.getElementById('pDesc').value.trim();
  const weekly = document.getElementById('pWeekly').checked;
  const imgUrl = document.getElementById('pImgUrl').value.trim();
  const image = productImgData || imgUrl || '';

  if (!name || !price) { toast('ÃœrÃ¼n adÄ± ve fiyat zorunludur', 'error'); return; }
  showLoading(true);
  try {
    const data = { name, category, price, oldPrice, description, weekly, image, updatedAt: serverTimestamp() };
    if (editingProdId) {
      await updateDoc(doc(db, 'products', editingProdId), data);
      toast('ÃœrÃ¼n gÃ¼ncellendi âœ…', 'success');
    } else {
      data.createdAt = serverTimestamp();
      await addDoc(collection(db, 'products'), data);
      toast('ÃœrÃ¼n eklendi âœ…', 'success');
    }
    showLoading(false);
    clearProdForm();
  } catch(e) {
    showLoading(false);
    toast('Hata: ' + e.message, 'error');
  }
};

window.prevImgUrl = function() {
  const url = document.getElementById('pImgUrl').value.trim();
  productImgData = '';
  document.getElementById('imgPrev').innerHTML = url
    ? `<img src="${url}" alt="" onerror="this.parentElement.innerHTML='âŒ GÃ¶rsel yÃ¼klenemedi'">`
    : 'ğŸ–¼ï¸';
};

window.prevImgFile = function() {
  const file = document.getElementById('pImgFile').files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    productImgData = e.target.result;
    document.getElementById('pImgUrl').value = '';
    document.getElementById('imgPrev').innerHTML = `<img src="${productImgData}" alt="">`;
  };
  reader.readAsDataURL(file);
};

window.setImgTab = function(mode, el) {
  document.querySelectorAll('.img-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('imgUrlGrp').style.display = mode === 'url' ? 'block' : 'none';
  document.getElementById('imgFileGrp').style.display = mode === 'upload' ? 'block' : 'none';
};

// â”€â”€ Admin Settings â”€â”€
function renderAdmSettings() {
  document.getElementById('setIban').value = settings.iban || '';
  document.getElementById('setIbanName').value = settings.ibanName || '';
  document.getElementById('setDelivery').value = settings.deliveryTime || '15-30';
  document.getElementById('setFlatMin').value = settings.flatMin || 1;
  document.getElementById('setFlatMax').value = settings.flatMax || 50;
  renderBlockList();
}

function renderBlockList() {
  const blocks = settings.blocks || [];
  document.getElementById('blockList').innerHTML = blocks.length
    ? blocks.map((b, i) => `
      <div class="block-item">
        <span class="block-name">ğŸ¢ ${b} Blok</span>
        <button class="btn btn-sm btn-danger" onclick="removeBlock(${i})">Sil</button>
      </div>
    `).join('')
    : '<p style="color:var(--text-muted);font-size:14px">Blok eklenmemiÅŸ.</p>';
}

window.addBlock = function() {
  const val = document.getElementById('newBlockInput').value.trim().toUpperCase();
  if (!val) { toast('Blok harfi giriniz', 'error'); return; }
  if (!settings.blocks) settings.blocks = [];
  if (settings.blocks.includes(val)) { toast('Bu blok zaten var', 'error'); return; }
  settings.blocks.push(val);
  renderBlockList();
  document.getElementById('newBlockInput').value = '';
};

window.removeBlock = function(idx) {
  if (!settings.blocks) return;
  settings.blocks.splice(idx, 1);
  renderBlockList();
};

</script>
</body>
</html>
